<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/compression/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#compression">compression</a>
      </div>

      <div class="heading h2">
        <a href="#install">Install</a>
      </div>

      <div class="heading h2">
        <a href="#api">API</a>
      </div>

      <div class="heading h3">
        <a href="#compression-options">compression([options])</a>
      </div>

      <div class="heading h4">
        <a href="#options">Options</a>
      </div>

      <div class="heading h5">
        <a href="#chunksize">chunkSize</a>
      </div>

      <div class="heading h5">
        <a href="#filter">filter</a>
      </div>

      <div class="heading h5">
        <a href="#level">level</a>
      </div>

      <div class="heading h5">
        <a href="#memlevel">memLevel</a>
      </div>

      <div class="heading h5">
        <a href="#strategy">strategy</a>
      </div>

      <div class="heading h5">
        <a href="#threshold">threshold</a>
      </div>

      <div class="heading h5">
        <a href="#windowbits">windowBits</a>
      </div>

      <div class="heading h4">
        <a href="#.filter">.filter</a>
      </div>

      <div class="heading h3">
        <a href="#res.flush">res.flush</a>
      </div>

      <div class="heading h2">
        <a href="#examples">Examples</a>
      </div>

      <div class="heading h3">
        <a href="#expressconnect">express/connect</a>
      </div>

      <div class="heading h3">
        <a href="#server-sent-events">Server-Sent Events</a>
      </div>

      <div class="heading h2">
        <a href="#license">License</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="compression">
  <h1>
    <a href="#compression" name="compression" class="pilcrow"></a>
compression
  </h1>
</div>
<p><a href="https://npmjs.org/package/compression"><img src="https://img.shields.io/npm/v/compression.svg" alt="NPM Version"></a>
<a href="https://npmjs.org/package/compression"><img src="https://img.shields.io/npm/dm/compression.svg" alt="NPM Downloads"></a>
<a href="https://travis-ci.org/expressjs/compression"><img src="https://img.shields.io/travis/expressjs/compression/master.svg" alt="Build Status"></a>
<a href="https://coveralls.io/r/expressjs/compression?branch=master"><img src="https://img.shields.io/coveralls/expressjs/compression/master.svg" alt="Test Coverage"></a>
<a href="https://www.gratipay.com/dougwilson/"><img src="https://img.shields.io/gratipay/dougwilson.svg" alt="Gratipay"></a></p>
<p>Node.js compression middleware.</p>
<p>The following compression codings are supported:</p>
<ul>
<li>deflate</li>
<li>gzip</li>
</ul>
<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow"></a>
Install
  </h2>
</div>
<pre><code class="bash">$ npm install compression
</code></pre>
<div class="pilwrap" id="api">
  <h2>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h2>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> compression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression'</span>)
</code></pre>
<div class="pilwrap" id="compression-options">
  <h3>
    <a href="#compression-options" name="compression-options" class="pilcrow"></a>
compression([options])
  </h3>
</div>
<p>Returns the compression middleware using the given <code>options</code>. The middleware
will attempt to compress response bodies for all request that traverse through
the middleware, based on the given <code>options</code>.</p>
<p>This middleware will never compress responses that include a <code>Cache-Control</code>
header with the <a href="https://tools.ietf.org/html/rfc7234#section-5.2.2.4"><code>no-transform</code> directive</a>,
as compressing will transform the body.</p>
<div class="pilwrap" id="options">
  <h4>
    <a href="#options" name="options" class="pilcrow"></a>
Options
  </h4>
</div>
<p><code>compression()</code> accepts these properties in the options object. In addition to
those listed below, <a href="http://nodejs.org/api/zlib.html">zlib</a> options may be
passed in to the options object.</p>
<div class="pilwrap" id="chunksize">
  <h5>
    <a href="#chunksize" name="chunksize" class="pilcrow"></a>
chunkSize
  </h5>
</div>
<p>The default value is <code>zlib.Z_DEFAULT_CHUNK</code>, or <code>16384</code>.</p>
<p>See <a href="http://nodejs.org/api/zlib.html#zlib_memory_usage_tuning">Node.js documentation</a>
regarding the usage.</p>
<div class="pilwrap" id="filter">
  <h5>
    <a href="#filter" name="filter" class="pilcrow"></a>
filter
  </h5>
</div>
<p>A function to decide if the response should be considered for compression.
This function is called as <code>filter(req, res)</code> and is expected to return
<code>true</code> to consider the response for compression, or <code>false</code> to not compress
the response.</p>
<p>The default filter function uses the <a href="https://www.npmjs.com/package/compressible">compressible</a>
module to determine if <code>res.getHeader('Content-Type')</code> is compressible.</p>
<div class="pilwrap" id="level">
  <h5>
    <a href="#level" name="level" class="pilcrow"></a>
level
  </h5>
</div>
<p>The level of zlib compression to apply to responses. A higher level will result
in better compression, but will take longer to complete. A lower level will
result in less compression, but will be much faster.</p>
<p>This is an integer in the range of <code>0</code> (no compression) to <code>9</code> (maximum
compression). The special value <code>-1</code> can be used to mean the &quot;default
compression level&quot;, which is a default compromise between speed and
compression (currently equivalent to level 6).</p>
<ul>
<li><code>-1</code> Default compression level (also <code>zlib.Z_DEFAULT_COMPRESSION</code>).</li>
<li><code>0</code> No compression (also <code>zlib.Z_NO_COMPRESSION</code>).</li>
<li><code>1</code> Fastest compression (also <code>zlib.Z_BEST_SPEED</code>).</li>
<li><code>2</code></li>
<li><code>3</code></li>
<li><code>4</code></li>
<li><code>5</code></li>
<li><code>6</code> (currently what <code>zlib.Z_DEFAULT_COMPRESSION</code> points to).</li>
<li><code>7</code></li>
<li><code>8</code></li>
<li><code>9</code> Best compression (also <code>zlib.Z_BEST_COMPRESSION</code>).</li>
</ul>
<p>The default value is <code>zlib.Z_DEFAULT_COMPRESSION</code>, or <code>-1</code>.</p>
<p><strong>Note</strong> in the list above, <code>zlib</code> is from <code>zlib = require('zlib')</code>.</p>
<div class="pilwrap" id="memlevel">
  <h5>
    <a href="#memlevel" name="memlevel" class="pilcrow"></a>
memLevel
  </h5>
</div>
<p>This specifies how much memory should be allocated for the internal compression
state and is an integer in the range of <code>1</code> (minimum level) and <code>9</code> (maximum
level).</p>
<p>The default value is <code>zlib.Z_DEFAULT_MEMLEVEL</code>, or <code>8</code>.</p>
<p>See <a href="http://nodejs.org/api/zlib.html#zlib_memory_usage_tuning">Node.js documentation</a>
regarding the usage.</p>
<div class="pilwrap" id="strategy">
  <h5>
    <a href="#strategy" name="strategy" class="pilcrow"></a>
strategy
  </h5>
</div>
<p>This is used to tune the compression algorithm. This value only affects the
compression ratio, not the correctness of the compressed output, even if it
is not set appropriately.</p>
<ul>
<li><code>zlib.Z_DEFAULT_STRATEGY</code> Use for normal data.</li>
<li><code>zlib.Z_FILTERED</code> Use for data produced by a filter (or predictor).
Filtered data consists mostly of small values with a somewhat random
distribution. In this case, the compression algorithm is tuned to
compress them better. The effect is to force more Huffman coding and less
string matching; it is somewhat intermediate between <code>zlib.Z_DEFAULT_STRATEGY</code>
and <code>zlib.Z_HUFFMAN_ONLY</code>.</li>
<li><code>zlib.Z_FIXED</code> Use to prevent the use of dynamic Huffman codes, allowing
for a simpler decoder for special applications.</li>
<li><code>zlib.Z_HUFFMAN_ONLY</code> Use to force Huffman encoding only (no string match).</li>
<li><code>zlib.Z_RLE</code> Use to limit match distances to one (run-length encoding).
This is designed to be almost as fast as <code>zlib.Z_HUFFMAN_ONLY</code>, but give
better compression for PNG image data.</li>
</ul>
<p><strong>Note</strong> in the list above, <code>zlib</code> is from <code>zlib = require('zlib')</code>.</p>
<div class="pilwrap" id="threshold">
  <h5>
    <a href="#threshold" name="threshold" class="pilcrow"></a>
threshold
  </h5>
</div>
<p>The byte threshold for the response body size before compression is considered
for the response, defaults to <code>1kb</code>. This is a number of bytes, any string
accepted by the <a href="https://www.npmjs.com/package/bytes">bytes</a> module, or <code>false</code>.</p>
<p><strong>Note</strong> this is only an advisory setting; if the response size cannot be determined
at the time the response headers are written, then it is assumed the response is
<em>over</em> the threshold. To guarantee the response size can be determined, be sure
set a <code>Content-Length</code> response header.</p>
<div class="pilwrap" id="windowbits">
  <h5>
    <a href="#windowbits" name="windowbits" class="pilcrow"></a>
windowBits
  </h5>
</div>
<p>The default value is <code>zlib.Z_DEFAULT_WINDOWBITS</code>, or <code>15</code>.</p>
<p>See <a href="http://nodejs.org/api/zlib.html#zlib_memory_usage_tuning">Node.js documentation</a>
regarding the usage.</p>
<div class="pilwrap" id=".filter">
  <h4>
    <a href="#.filter" name=".filter" class="pilcrow"></a>
.filter
  </h4>
</div>
<p>The default <code>filter</code> function. This is used to construct a custom filter
function that is an extension of the default function.</p>
<pre><code class="js">app.use(compression({<span class="hljs-attr">filter</span>: shouldCompress}))

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldCompress</span>(<span class="hljs-params">req, res</span>) </span>{
  <span class="hljs-keyword">if</span> (req.headers[<span class="hljs-string">'x-no-compression'</span>]) {
    <span class="hljs-comment">// don't compress responses with this request header</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }

  <span class="hljs-comment">// fallback to standard filter function</span>
  <span class="hljs-keyword">return</span> compression.filter(req, res)
}
</code></pre>
<div class="pilwrap" id="res.flush">
  <h3>
    <a href="#res.flush" name="res.flush" class="pilcrow"></a>
res.flush
  </h3>
</div>
<p>This module adds a <code>res.flush()</code> method to force the partially-compressed
response to be flushed to the client.</p>
<div class="pilwrap" id="examples">
  <h2>
    <a href="#examples" name="examples" class="pilcrow"></a>
Examples
  </h2>
</div>
<div class="pilwrap" id="expressconnect">
  <h3>
    <a href="#expressconnect" name="expressconnect" class="pilcrow"></a>
express/connect
  </h3>
</div>
<p>When using this module with express or connect, simply <code>app.use</code> the module as
high as you like. Requests that pass through the middleware will be compressed.</p>
<pre><code class="js"><span class="hljs-keyword">var</span> compression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression'</span>)
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)

<span class="hljs-keyword">var</span> app = express()

<span class="hljs-comment">// compress all requests</span>
app.use(compression())

<span class="hljs-comment">// add all routes</span>
</code></pre>
<div class="pilwrap" id="server-sent-events">
  <h3>
    <a href="#server-sent-events" name="server-sent-events" class="pilcrow"></a>
Server-Sent Events
  </h3>
</div>
<p>Because of the nature of compression this module does not work out of the box
with server-sent events. To compress content, a window of the output needs to
be buffered up in order to get good compression. Typically when using server-sent
events, there are certain block of data that need to reach the client.</p>
<p>You can achieve this by calling <code>res.flush()</code> when you need the data written to
actually make it to the client.</p>
<pre><code class="js"><span class="hljs-keyword">var</span> compression = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression'</span>)
<span class="hljs-keyword">var</span> express     = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)

<span class="hljs-keyword">var</span> app = express()

<span class="hljs-comment">// compress responses</span>
app.use(compression())

<span class="hljs-comment">// server-sent event stream</span>
app.get(<span class="hljs-string">'/events'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/event-stream'</span>)
  res.setHeader(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'no-cache'</span>)

  <span class="hljs-comment">// send a ping approx every 2 seconds</span>
  <span class="hljs-keyword">var</span> timer = setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    res.write(<span class="hljs-string">'data: ping\n\n'</span>)

    <span class="hljs-comment">// !!! this is the important part</span>
    res.flush()
  }, <span class="hljs-number">2000</span>)

  res.on(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    clearInterval(timer)
  })
})
</code></pre>
<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow"></a>
License
  </h2>
</div>
<p><a href="LICENSE.html">MIT</a></p>
</div>
  </div>
</body>
</html>
