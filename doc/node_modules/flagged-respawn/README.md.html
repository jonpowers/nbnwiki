<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/flagged-respawn/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#flagged-respawn">flagged-respawn </a>
      </div>

      <div class="heading h2">
        <a href="#what-is-it">What is it?</a>
      </div>

      <div class="heading h2">
        <a href="#sample-usage">Sample Usage</a>
      </div>

      <div class="heading h2">
        <a href="#release-history">Release History</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="flagged-respawn">
  <h1>
    <a href="#flagged-respawn" name="flagged-respawn" class="pilcrow"></a>
flagged-respawn <a href="http://travis-ci.org/js-cli/js-flagged-respawn"><img src="https://secure.travis-ci.org/js-cli/js-flagged-respawn.svg" alt="Build Status"></a>
  </h1>
</div>
<blockquote>
<p>A tool for respawning node binaries when special flags are present.</p>
</blockquote>
<p><a href="https://nodei.co/npm/flagged-respawn/"><img src="https://nodei.co/npm/flagged-respawn.png" alt="NPM"></a></p>
<div class="pilwrap" id="what-is-it">
  <h2>
    <a href="#what-is-it" name="what-is-it" class="pilcrow"></a>
What is it?
  </h2>
</div>
<p>Say you wrote a command line tool that runs arbitrary javascript (e.g. task runner, test framework, etc). For the sake of discussion, let's pretend it's a testing harness you've named <code>testify</code>.</p>
<p>Everything is going splendidly until one day you decide to test some code that relies on a feature behind a v8 flag in node (<code>--harmony</code>, for example).  Without much thought, you run <code>testify --harmony spec tests.js</code>.</p>
<p>It doesn't work. After digging around for a bit, you realize this produces a <a href="http://nodejs.org/docs/latest/api/process.html#process_process_argv"><code>process.argv</code></a> of:</p>
<p><code>['node', '/usr/local/bin/test', '--harmony', 'spec', 'tests.js']</code></p>
<p>Crap. The <code>--harmony</code> flag is in the wrong place! It should be applied to the <strong>node</strong> command, not our binary. What we actually wanted was this:</p>
<p><code>['node', '--harmony', '/usr/local/bin/test', 'spec', 'tests.js']</code></p>
<p>Flagged-respawn fixes this problem and handles all the edge cases respawning creates, such as:</p>
<ul>
<li>Providing a method to determine if a respawn is needed.</li>
<li>Piping stderr/stdout from the child into the parent.</li>
<li>Making the parent process exit with the same code as the child.</li>
<li>If the child is killed, making the parent exit with the same signal.</li>
</ul>
<p>To see it in action, clone this repository and run <code>npm install</code> / <code>npm run respawn</code> / <code>npm run nospawn</code>.</p>
<div class="pilwrap" id="sample-usage">
  <h2>
    <a href="#sample-usage" name="sample-usage" class="pilcrow"></a>
Sample Usage
  </h2>
</div>
<pre><code class="js"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-keyword">const</span> flaggedRespawn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'flagged-respawn'</span>);

<span class="hljs-comment">// get a list of all possible v8 flags for the running version of node</span>
<span class="hljs-keyword">const</span> v8flags = <span class="hljs-built_in">require</span>(<span class="hljs-string">'v8flags'</span>).fetch();

flaggedRespawn(v8flags, process.argv, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ready, child</span>) </span>{
  <span class="hljs-keyword">if</span> (ready) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Running!'</span>);
    <span class="hljs-comment">// your cli code here</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Special flags found, respawning.'</span>);
  }
  <span class="hljs-keyword">if</span> (process.pid !== child.pid) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Respawned to PID:'</span>, child.pid);
  }
});

</code></pre>
<div class="pilwrap" id="release-history">
  <h2>
    <a href="#release-history" name="release-history" class="pilcrow"></a>
Release History
  </h2>
</div>
<ul>
<li>2016-03-22 - v0.3.2 - fix issue with v8 flags values being dropped</li>
<li>2014-09-12 - v0.3.1 - use <code>{ stdio: 'inherit' }</code> for spawn to maintain colors</li>
<li>2014-09-11 - v0.3.0 - for real this time</li>
<li>2014-09-11 - v0.2.0 - cleanup</li>
<li>2014-09-04 - v0.1.1 - initial release</li>
</ul>
</div>
  </div>
</body>
</html>
