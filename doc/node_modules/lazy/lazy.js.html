<!DOCTYPE html>
<html>
<head>
  <title>lazy.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/lazy/lazy.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>lazy.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>).EventEmitter;
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Lazy</span>(<span class="hljs-params">em, opts</span>) </span>{
    <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> Lazy)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Lazy(em, opts);
    EventEmitter.call(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;


    self.once = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, f</span>) </span>{
        self.on(name, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span> (<span class="hljs-params"></span>) </span>{
            self.removeListener(name, g);
            f.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        });
    }

    <span class="hljs-keyword">if</span> (!opts) opts = {};
    <span class="hljs-keyword">var</span> dataName = opts.data || <span class="hljs-string">'data'</span>;
    <span class="hljs-keyword">var</span> pipeName = opts.pipe || <span class="hljs-string">'pipe'</span>;
    <span class="hljs-keyword">var</span> endName = opts.pipe || <span class="hljs-string">'end'</span>;

    <span class="hljs-keyword">if</span> (pipeName != endName) {
        <span class="hljs-keyword">var</span> piped = <span class="hljs-literal">false</span>;
        self.once(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ piped = <span class="hljs-literal">true</span> });
        self.once(endName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!piped) self.emit(pipeName);
        });
    }

    self.push = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
        self.emit(dataName, x);
    }

    self.end = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        self.emit(endName);
    }

    <span class="hljs-keyword">if</span> (em &amp;&amp; em.on) {
        em.on(endName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            self.emit(endName);
        });
        self.on(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            em.emit(pipeName);
        });
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Check for v0.10 or Greater (Stream2 has Duplex type)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (stream.Duplex &amp;&amp; em <span class="hljs-keyword">instanceof</span>(stream)) {
            em.on(<span class="hljs-string">'readable'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> x = em.read();
                self.emit(dataName, x);
            });
        } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Old Stream1 or Event support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            em.on(dataName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
                self.emit(dataName, x);
            });
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newLazy</span> (<span class="hljs-params">g, h, l</span>) </span>{
        <span class="hljs-keyword">if</span> (!g) {
            g = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            };
        }
        <span class="hljs-keyword">if</span> (!h) {
            h = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
                <span class="hljs-keyword">return</span> x;
            };
        }
        <span class="hljs-keyword">var</span> lazy = <span class="hljs-keyword">new</span> Lazy(<span class="hljs-literal">null</span>, opts, l);
        self.on(dataName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{
            <span class="hljs-keyword">if</span> (g.call(lazy, x)) {
                lazy.emit(dataName, h(x), y);
            }
        });
        self.once(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            lazy.emit(pipeName);
        });
        <span class="hljs-keyword">return</span> lazy;
    }

    self.filter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            <span class="hljs-keyword">return</span> f(x);
        });
    }

    self.forEach = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            f(x);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
    }

    self.map = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">return</span> newLazy(
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> f(x) }
        );
    }

    self.head = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">var</span> lazy = newLazy();
        lazy.on(dataName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span> (<span class="hljs-params">x</span>) </span>{
            f(x)
            lazy.removeListener(dataName, g)
        })
    }

    self.tail = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> skip = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (skip) {
                skip = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
    }

    self.skip = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>) {
                n--;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
    }

    self.take = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">n</span>) </span>{
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) self.emit(pipeName);
            <span class="hljs-keyword">return</span> n-- &gt; <span class="hljs-number">0</span>;
        });
    }

    self.takeWhile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">var</span> cond = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            <span class="hljs-keyword">if</span> (cond &amp;&amp; f(x)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            cond = <span class="hljs-literal">false</span>;
            self.emit(pipeName);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        });
    }

    self.foldr = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">op, i, f</span>) </span>{
        <span class="hljs-keyword">var</span> acc = i;
        <span class="hljs-keyword">var</span> lazy = newLazy();
        lazy.on(dataName, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span> (<span class="hljs-params">x</span>) </span>{
            acc = op(x, acc);
        });
        lazy.once(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            f(acc);
        });
    }

    self.sum = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">return</span> self.foldr(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, acc</span>) </span>{ <span class="hljs-keyword">return</span> x + acc }, <span class="hljs-number">0</span>, f);
    }

    self.product = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">return</span> self.foldr(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, acc</span>) </span>{ <span class="hljs-keyword">return</span> x*acc }, <span class="hljs-number">1</span>, f);
    }

    self.join = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">var</span> data = []
        <span class="hljs-keyword">var</span> lazy = newLazy(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            data.push(x);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        });
        lazy.once(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ f(data) });
        <span class="hljs-keyword">return</span> self;
    }

    self.bucket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">init, f</span>) </span>{
        <span class="hljs-keyword">var</span> lazy = <span class="hljs-keyword">new</span> Lazy(<span class="hljs-literal">null</span>, opts);
        <span class="hljs-keyword">var</span> yieldTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            lazy.emit(dataName, x);
        };

        <span class="hljs-keyword">var</span> acc = init;

        self.on(dataName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
            acc = f.call(yieldTo, acc, x);
        });

        self.once(pipeName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            lazy.emit(pipeName);
        });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>flush on end event</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        self.once(endName, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> finalBuffer = mergeBuffers(acc);
            <span class="hljs-keyword">if</span> (finalBuffer) {
                yieldTo(finalBuffer);
            }
        });

        <span class="hljs-keyword">return</span> lazy;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Streams that use this should emit strings or buffers only</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    self.__defineGetter__(<span class="hljs-string">'lines'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.bucket([], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunkArray, chunk</span>) </span>{
            <span class="hljs-keyword">var</span> newline = <span class="hljs-string">'\n'</span>.charCodeAt(<span class="hljs-number">0</span>), lastNewLineIndex = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> chunk === <span class="hljs-string">'string'</span>) chunk = <span class="hljs-keyword">new</span> Buffer(chunk);
        <span class="hljs-keyword">if</span> (chunk){
            	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; chunk.length; i++) {
                	<span class="hljs-keyword">if</span> (chunk[i] === newline) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>If we have content from the current chunk to append to our buffers, do it.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    		<span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
                        		chunkArray.push(chunk.slice(lastNewLineIndex, i));
                    		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Wrap all our buffers and emit it.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    		<span class="hljs-keyword">this</span>(mergeBuffers(chunkArray));
                    		lastNewLineIndex = i + <span class="hljs-number">1</span>;
                	}
            }
	    }

            <span class="hljs-keyword">if</span> (lastNewLineIndex &gt; <span class="hljs-number">0</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>New line found in the chunk, push the remaining part of the buffer.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (lastNewLineIndex &lt; chunk.length) {
                    chunkArray.push(chunk.slice(lastNewLineIndex));
                }
            } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>No new line found, push the whole buffer.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (chunk &amp;&amp; chunk.length) {
                    chunkArray.push(chunk);
                }
            }
            <span class="hljs-keyword">return</span> chunkArray;
        });
    });
}

Lazy.range = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>;
    <span class="hljs-keyword">var</span> step = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> infinite = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, j = args[<span class="hljs-number">0</span>];
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">typeof</span> args[<span class="hljs-number">0</span>] == <span class="hljs-string">'string'</span>) { <span class="hljs-comment">// 'start[,next]..[end]'</span>
        <span class="hljs-keyword">var</span> arg = args[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">var</span> startOpen = <span class="hljs-literal">false</span>, endClosed = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (arg[<span class="hljs-number">0</span>] == <span class="hljs-string">'('</span> || arg[<span class="hljs-number">0</span>] == <span class="hljs-string">'['</span>) {
            <span class="hljs-keyword">if</span> (arg[<span class="hljs-number">0</span>] == <span class="hljs-string">'('</span>) startOpen = <span class="hljs-literal">true</span>;
            arg = arg.slice(<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">if</span> (arg.slice(<span class="hljs-number">-1</span>) == <span class="hljs-string">']'</span>) endClosed = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">var</span> parts = arg.split(<span class="hljs-string">'..'</span>);
        <span class="hljs-keyword">if</span> (parts.length != <span class="hljs-number">2</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"single argument range takes 'start..' or 'start..end' or 'start,next..end'"</span>);

        <span class="hljs-keyword">if</span> (parts[<span class="hljs-number">1</span>] == <span class="hljs-string">''</span>) { <span class="hljs-comment">// 'start..'</span>
            <span class="hljs-keyword">var</span> i = parts[<span class="hljs-number">0</span>];
            infinite = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 'start[,next]..end'</span>
            <span class="hljs-keyword">var</span> progression = parts[<span class="hljs-number">0</span>].split(<span class="hljs-string">','</span>);
            <span class="hljs-keyword">if</span> (progression.length == <span class="hljs-number">1</span>) { <span class="hljs-comment">// start..end</span>
                <span class="hljs-keyword">var</span> i = parts[<span class="hljs-number">0</span>], j = parts[<span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// 'start,next..end'</span>
                <span class="hljs-keyword">var</span> i = progression[<span class="hljs-number">0</span>], j = parts[<span class="hljs-number">1</span>];
                step = <span class="hljs-built_in">Math</span>.abs(progression[<span class="hljs-number">1</span>]-i);
            }
        }

        i = <span class="hljs-built_in">parseInt</span>(i, <span class="hljs-number">10</span>);
        j = <span class="hljs-built_in">parseInt</span>(j, <span class="hljs-number">10</span>);

        <span class="hljs-keyword">if</span> (startOpen) {
            <span class="hljs-keyword">if</span> (infinite || i &lt; j) i++;
            <span class="hljs-keyword">else</span> i--;
        }

        <span class="hljs-keyword">if</span> (endClosed) {
            <span class="hljs-keyword">if</span> (i &lt; j) j++;
            <span class="hljs-keyword">else</span> j--;
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">2</span> || args.length == <span class="hljs-number">3</span>) { <span class="hljs-comment">// start, end[, step]</span>
        <span class="hljs-keyword">var</span> i = args[<span class="hljs-number">0</span>], j = args[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span> (args.length == <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">var</span> step = args[<span class="hljs-number">2</span>];
        }
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"range takes 1, 2 or 3 arguments"</span>);
    }
    <span class="hljs-keyword">var</span> lazy = <span class="hljs-keyword">new</span> Lazy;
    <span class="hljs-keyword">var</span> stopInfinite = <span class="hljs-literal">false</span>;
    lazy.on(<span class="hljs-string">'pipe'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        stopInfinite = <span class="hljs-literal">true</span>;
    });
    <span class="hljs-keyword">if</span> (infinite) {
        process.nextTick(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (stopInfinite) <span class="hljs-keyword">return</span>;
            lazy.emit(<span class="hljs-string">'data'</span>, i++);
            process.nextTick(g);
        });
    }
    <span class="hljs-keyword">else</span> {
        process.nextTick(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (i &lt; j) {
                <span class="hljs-keyword">for</span> (; i&lt;j; i+=step) {
                    lazy.emit(<span class="hljs-string">'data'</span>, i)
                }
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (; i&gt;j; i-=step) {
                    lazy.emit(<span class="hljs-string">'data'</span>, i)
                }
            }
            lazy.emit(<span class="hljs-string">'end'</span>);
        });
    }
    <span class="hljs-keyword">return</span> lazy;
}

<span class="hljs-keyword">var</span> mergeBuffers = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mergeBuffers</span>(<span class="hljs-params">buffers</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>We expect buffers to be a non-empty Array</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!buffers || !<span class="hljs-built_in">Array</span>.isArray(buffers) || !buffers.length) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">var</span> finalBufferLength, finalBuffer, currentBuffer, currentSize = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Sum all the buffers lengths</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  finalBufferLength = buffers.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">left, right</span>) </span>{ <span class="hljs-keyword">return</span> (left.length||left) + (right.length||right); }, <span class="hljs-number">0</span>);
  finalBuffer = <span class="hljs-keyword">new</span> Buffer(finalBufferLength);
  <span class="hljs-keyword">while</span>(buffers.length) {
    currentBuffer = buffers.shift();
    currentBuffer.copy(finalBuffer, currentSize);
    currentSize += currentBuffer.length;
  }

  <span class="hljs-keyword">return</span> finalBuffer;
}


util.inherits(Lazy, EventEmitter);
<span class="hljs-built_in">module</span>.exports = Lazy;

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
