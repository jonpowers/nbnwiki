<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/readdirp/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#readdirp">readdirp </a>
      </div>

      <div class="heading h1">
        <a href="#installation">Installation</a>
      </div>

      <div class="heading h1">
        <a href="#api">API</a>
      </div>

      <div class="heading h2">
        <a href="#entry-stream">entry stream</a>
      </div>

      <div class="heading h2">
        <a href="#options">options</a>
      </div>

      <div class="heading h2">
        <a href="#entry-info">entry info</a>
      </div>

      <div class="heading h2">
        <a href="#filters">Filters</a>
      </div>

      <div class="heading h2">
        <a href="#callback-api">Callback API</a>
      </div>

      <div class="heading h3">
        <a href="#allprocessed">allProcessed</a>
      </div>

      <div class="heading h3">
        <a href="#fileprocessed">fileProcessed</a>
      </div>

      <div class="heading h1">
        <a href="#more-examples">More Examples</a>
      </div>

      <div class="heading h2">
        <a href="#stream-api">stream api</a>
      </div>

      <div class="heading h2">
        <a href="#stream-api-pipe">stream api pipe</a>
      </div>

      <div class="heading h2">
        <a href="#grep">grep</a>
      </div>

      <div class="heading h2">
        <a href="#using-callback-api">using callback api</a>
      </div>

      <div class="heading h2">
        <a href="#tests">tests</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="readdirp">
  <h1>
    <a href="#readdirp" name="readdirp" class="pilcrow"></a>
readdirp <a href="http://travis-ci.org/thlorenz/readdirp"><img src="https://secure.travis-ci.org/thlorenz/readdirp.png" alt="Build Status"></a>
  </h1>
</div>
<p><a href="https://nodei.co/npm/readdirp/"><img src="https://nodei.co/npm/readdirp.png?downloads=true&amp;stars=true" alt="NPM"></a></p>
<p>Recursive version of <a href="http://nodejs.org/docs/latest/api/fs.html#fs_fs_readdir_path_callback">fs.readdir</a>. Exposes a <strong>stream api</strong>.</p>
<pre><code class="javascript"><span class="hljs-keyword">var</span> readdirp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readdirp'</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
  , es = <span class="hljs-built_in">require</span>(<span class="hljs-string">'event-stream'</span>);

<span class="hljs-comment">// print out all JavaScript files along with their size</span>

<span class="hljs-keyword">var</span> stream = readdirp({ <span class="hljs-attr">root</span>: path.join(__dirname), <span class="hljs-attr">fileFilter</span>: <span class="hljs-string">'*.js'</span> });
stream
  .on(<span class="hljs-string">'warn'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{ 
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'non-fatal error'</span>, err); 
    <span class="hljs-comment">// optionally call stream.destroy() here in order to abort and cause 'close' to be emitted</span>
  })
  .on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{ <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'fatal error'</span>, err); })
  .pipe(es.mapSync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{ 
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">path</span>: entry.path, <span class="hljs-attr">size</span>: entry.stat.size };
  }))
  .pipe(es.stringify())
  .pipe(process.stdout);
</code></pre>
<p>Meant to be one of the recursive versions of <a href="http://nodejs.org/docs/latest/api/fs.html">fs</a> functions, e.g., like <a href="https://github.com/substack/node-mkdirp">mkdirp</a>.</p>
<p><strong>Table of Contents</strong>  <em>generated with <a href="http://doctoc.herokuapp.com/">DocToc</a></em></p>
<ul>
<li><a href="#installation.html">Installation</a></li>
<li><a href="#api.html">API</a>
<ul>
<li><a href="#entry-stream.html">entry stream</a></li>
<li><a href="#options.html">options</a></li>
<li><a href="#entry-info.html">entry info</a></li>
<li><a href="#filters.html">Filters</a></li>
<li><a href="#callback-api.html">Callback API</a>
<ul>
<li><a href="#allprocessed.html">allProcessed </a></li>
<li><a href="#fileprocessed.html">fileProcessed</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#more-examples.html">More Examples</a>
<ul>
<li><a href="#stream-api.html">stream api</a></li>
<li><a href="#stream-api-pipe.html">stream api pipe</a></li>
<li><a href="#grep.html">grep</a></li>
<li><a href="#using-callback-api.html">using callback api</a></li>
<li><a href="#tests.html">tests</a></li>
</ul>
</li>
</ul>
<div class="pilwrap" id="installation">
  <h1>
    <a href="#installation" name="installation" class="pilcrow"></a>
Installation
  </h1>
</div>
<pre><code>npm install readdirp
</code></pre>
<div class="pilwrap" id="api">
  <h1>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h1>
</div>
<p><strong><em>var entryStream = readdirp (options)</em></strong></p>
<p>Reads given root recursively and returns a <code>stream</code> of <a href="#entry-info.html">entry info</a>s.</p>
<div class="pilwrap" id="entry-stream">
  <h2>
    <a href="#entry-stream" name="entry-stream" class="pilcrow"></a>
entry stream
  </h2>
</div>
<p>Behaves as follows:</p>
<ul>
<li><code>emit('data')</code> passes an <a href="#entry-info.html">entry info</a> whenever one is found</li>
<li><code>emit('warn')</code> passes a non-fatal <code>Error</code> that prevents a file/directory from being processed (i.e., if it is
inaccessible to the user)</li>
<li><code>emit('error')</code> passes a fatal <code>Error</code> which also ends the stream (i.e., when illegal options where passed)</li>
<li><code>emit('end')</code> called when all entries were found and no more will be emitted (i.e., we are done)</li>
<li><code>emit('close')</code> called when the stream is destroyed via <code>stream.destroy()</code> (which could be useful if you want to
manually abort even on a non fatal error) - at that point the stream is no longer <code>readable</code> and no more entries,
warning or errors are emitted</li>
<li>to learn more about streams, consult the very detailed
<a href="http://nodejs.org/api/stream.html">nodejs streams documentation</a> or the
<a href="https://github.com/substack/stream-handbook">stream-handbook</a></li>
</ul>
<div class="pilwrap" id="options">
  <h2>
    <a href="#options" name="options" class="pilcrow"></a>
options
  </h2>
</div>
<ul>
<li>
<p><strong>root</strong>: path in which to start reading and recursing into subdirectories</p>
</li>
<li>
<p><strong>fileFilter</strong>: filter to include/exclude files found (see <a href="#filters.html">Filters</a> for more)</p>
</li>
<li>
<p><strong>directoryFilter</strong>: filter to include/exclude directories found and to recurse into (see <a href="#filters.html">Filters</a> for more)</p>
</li>
<li>
<p><strong>depth</strong>: depth at which to stop recursing even if more subdirectories are found</p>
</li>
<li>
<p><strong>entryType</strong>: determines if data events on the stream should be emitted for <code>'files'</code>, <code>'directories'</code>, <code>'both'</code>, or <code>'all'</code>. Setting to <code>'all'</code> will also include entries for other types of file descriptors like character devices, unix sockets and named pipes. Defaults to <code>'files'</code>.</p>
</li>
<li>
<p><strong>lstat</strong>: if <code>true</code>, readdirp uses <code>fs.lstat</code> instead of <code>fs.stat</code> in order to stat files and includes symlink entries in the stream along with files.</p>
</li>
</ul>
<div class="pilwrap" id="entry-info">
  <h2>
    <a href="#entry-info" name="entry-info" class="pilcrow"></a>
entry info
  </h2>
</div>
<p>Has the following properties:</p>
<ul>
<li>
<p><strong>parentDir</strong>     :  directory in which entry was found (relative to given root)</p>
</li>
<li>
<p><strong>fullParentDir</strong> :  full path to parent directory</p>
</li>
<li>
<p><strong>name</strong>          :  name of the file/directory</p>
</li>
<li>
<p><strong>path</strong>          :  path to the file/directory (relative to given root)</p>
</li>
<li>
<p><strong>fullPath</strong>      :  full path to the file/directory found</p>
</li>
<li>
<p><strong>stat</strong>          :  built in <a href="http://nodejs.org/docs/v0.4.9/api/fs.html#fs.Stats">stat object</a></p>
</li>
<li>
<p><strong>Example</strong>: (assuming root was <code>/User/dev/readdirp</code>)</p>
<pre><code>  parentDir     :  'test/bed/root_dir1',
  fullParentDir :  '/User/dev/readdirp/test/bed/root_dir1',
  name          :  'root_dir1_subdir1',
  path          :  'test/bed/root_dir1/root_dir1_subdir1',
  fullPath      :  '/User/dev/readdirp/test/bed/root_dir1/root_dir1_subdir1',
  stat          :  [ ... ]
</code></pre>
</li>
</ul>
<div class="pilwrap" id="filters">
  <h2>
    <a href="#filters" name="filters" class="pilcrow"></a>
Filters
  </h2>
</div>
<p>There are three different ways to specify filters for files and directories respectively.</p>
<ul>
<li>
<p><strong>function</strong>: a function that takes an entry info as a parameter and returns true to include or false to exclude the entry</p>
</li>
<li>
<p><strong>glob string</strong>: a string (e.g., <code>*.js</code>) which is matched using <a href="https://github.com/isaacs/minimatch">minimatch</a>, so go there for more
information.</p>
<p>Globstars (<code>**</code>) are not supported since specifiying a recursive pattern for an already recursive function doesn't make sense.</p>
<p>Negated globs (as explained in the minimatch documentation) are allowed, e.g., <code>!*.txt</code> matches everything but text files.</p>
</li>
<li>
<p><strong>array of glob strings</strong>: either need to be all inclusive or all exclusive (negated) patterns otherwise an error is thrown.</p>
<p><code>[ '*.json', '*.js' ]</code> includes all JavaScript and Json files.</p>
</li>
</ul>
<pre><code>`[ '!.git', '!node_modules' ]` includes all directories except the '.git' and 'node_modules'.
</code></pre>
<p>Directories that do not pass a filter will not be recursed into.</p>
<div class="pilwrap" id="callback-api">
  <h2>
    <a href="#callback-api" name="callback-api" class="pilcrow"></a>
Callback API
  </h2>
</div>
<p>Although the stream api is recommended, readdirp also exposes a callback based api.</p>
<p><strong><em>readdirp (options, callback1 [, callback2])</em></strong></p>
<p>If callback2 is given, callback1 functions as the <strong>fileProcessed</strong> callback, and callback2 as the <strong>allProcessed</strong> callback.</p>
<p>If only callback1 is given, it functions as the <strong>allProcessed</strong> callback.</p>
<div class="pilwrap" id="allprocessed">
  <h3>
    <a href="#allprocessed" name="allprocessed" class="pilcrow"></a>
allProcessed
  </h3>
</div>
<ul>
<li>function with err and res parameters, e.g., <code>function (err, res) { ... }</code></li>
<li><strong>err</strong>: array of errors that occurred during the operation, <strong>res may still be present, even if errors occurred</strong></li>
<li><strong>res</strong>: collection of file/directory <a href="#entry-info.html">entry infos</a></li>
</ul>
<div class="pilwrap" id="fileprocessed">
  <h3>
    <a href="#fileprocessed" name="fileprocessed" class="pilcrow"></a>
fileProcessed
  </h3>
</div>
<ul>
<li>function with <a href="#entry-info.html">entry info</a> parameter e.g., <code>function (entryInfo) { ... }</code></li>
</ul>
<div class="pilwrap" id="more-examples">
  <h1>
    <a href="#more-examples" name="more-examples" class="pilcrow"></a>
More Examples
  </h1>
</div>
<p><code>on('error', ..)</code>, <code>on('warn', ..)</code> and <code>on('end', ..)</code> handling omitted for brevity</p>
<pre><code class="javascript"><span class="hljs-keyword">var</span> readdirp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readdirp'</span>);

<span class="hljs-comment">// Glob file filter</span>
readdirp({ <span class="hljs-attr">root</span>: <span class="hljs-string">'./test/bed'</span>, <span class="hljs-attr">fileFilter</span>: <span class="hljs-string">'*.js'</span> })
  .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-comment">// do something with each JavaScript file entry</span>
  });

<span class="hljs-comment">// Combined glob file filters</span>
readdirp({ <span class="hljs-attr">root</span>: <span class="hljs-string">'./test/bed'</span>, <span class="hljs-attr">fileFilter</span>: [ <span class="hljs-string">'*.js'</span>, <span class="hljs-string">'*.json'</span> ] })
  .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-comment">// do something with each JavaScript and Json file entry </span>
  });

<span class="hljs-comment">// Combined negated directory filters</span>
readdirp({ <span class="hljs-attr">root</span>: <span class="hljs-string">'./test/bed'</span>, <span class="hljs-attr">directoryFilter</span>: [ <span class="hljs-string">'!.git'</span>, <span class="hljs-string">'!*modules'</span> ] })
  .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-comment">// do something with each file entry found outside '.git' or any modules directory </span>
  });

<span class="hljs-comment">// Function directory filter</span>
readdirp({ <span class="hljs-attr">root</span>: <span class="hljs-string">'./test/bed'</span>, <span class="hljs-attr">directoryFilter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">di</span>) </span>{ <span class="hljs-keyword">return</span> di.name.length === <span class="hljs-number">9</span>; } })
  .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-comment">// do something with each file entry found inside directories whose name has length 9</span>
  });

<span class="hljs-comment">// Limiting depth</span>
readdirp({ <span class="hljs-attr">root</span>: <span class="hljs-string">'./test/bed'</span>, <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span> })
  .on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-comment">// do something with each file entry found up to 1 subdirectory deep</span>
  });

<span class="hljs-comment">// callback api</span>
readdirp(
    { <span class="hljs-attr">root</span>: <span class="hljs-string">'.'</span> }
  , <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileInfo</span>) </span>{ 
      <span class="hljs-comment">// do something with file entry here</span>
    } 
  , <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>{
      <span class="hljs-comment">// all done, move on or do final step for all file entries here</span>
    }
);
</code></pre>
<p>Try more examples by following <a href="https://github.com/thlorenz/readdirp/blob/master/examples/Readme.md">instructions</a>
on how to get going.</p>
<div class="pilwrap" id="stream-api">
  <h2>
    <a href="#stream-api" name="stream-api" class="pilcrow"></a>
stream api
  </h2>
</div>
<p><a href="https://github.com/thlorenz/readdirp/blob/master/examples/stream-api.js">stream-api.js</a></p>
<p>Demonstrates error and data handling by listening to events emitted from the readdirp stream.</p>
<div class="pilwrap" id="stream-api-pipe">
  <h2>
    <a href="#stream-api-pipe" name="stream-api-pipe" class="pilcrow"></a>
stream api pipe
  </h2>
</div>
<p><a href="https://github.com/thlorenz/readdirp/blob/master/examples/stream-api-pipe.js">stream-api-pipe.js</a></p>
<p>Demonstrates error handling by listening to events emitted from the readdirp stream and how to pipe the data stream into
another destination stream.</p>
<div class="pilwrap" id="grep">
  <h2>
    <a href="#grep" name="grep" class="pilcrow"></a>
grep
  </h2>
</div>
<p><a href="https://github.com/thlorenz/readdirp/blob/master/examples/grep.js">grep.js</a></p>
<p>Very naive implementation of grep, for demonstration purposes only.</p>
<div class="pilwrap" id="using-callback-api">
  <h2>
    <a href="#using-callback-api" name="using-callback-api" class="pilcrow"></a>
using callback api
  </h2>
</div>
<p><a href="https://github.com/thlorenz/readdirp/blob/master/examples/callback-api.js">callback-api.js</a></p>
<p>Shows how to pass callbacks in order to handle errors and/or data.</p>
<div class="pilwrap" id="tests">
  <h2>
    <a href="#tests" name="tests" class="pilcrow"></a>
tests
  </h2>
</div>
<p>The <a href="https://github.com/thlorenz/readdirp/blob/master/test/readdirp.js">readdirp tests</a> also will give you a good idea on
how things work.</p>
</div>
  </div>
</body>
</html>
