<!DOCTYPE html>
<html>
<head>
  <title>moment-timezone-utils.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/moment-timezone/moment-timezone-utils.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>moment-timezone-utils.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>! moment-timezone-utils.js
! version : 0.5.11
! Copyright (c) JS Foundation and other contributors
! license : MIT
! github.com/moment/moment-timezone</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">root, factory</span>) </span>{
<span class="hljs-meta">	"use strict"</span>;

	<span class="hljs-comment">/*global define*/</span>
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {
		define([<span class="hljs-string">'moment'</span>], factory);                 <span class="hljs-comment">// AMD</span>
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-built_in">module</span>.exports) {
		<span class="hljs-built_in">module</span>.exports = factory(<span class="hljs-built_in">require</span>(<span class="hljs-string">'./'</span>));     <span class="hljs-comment">// Node</span>
	} <span class="hljs-keyword">else</span> {
		factory(root.moment);                        <span class="hljs-comment">// Browser</span>
	}
}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">moment</span>) </span>{
<span class="hljs-meta">	"use strict"</span>;

	<span class="hljs-keyword">if</span> (!moment.tz) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"moment-timezone-utils.js must be loaded after moment-timezone.js"</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Pack Base 60</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	<span class="hljs-keyword">var</span> BASE60 = <span class="hljs-string">'0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX'</span>,
		EPSILON = <span class="hljs-number">0.000001</span>; <span class="hljs-comment">// Used to fix floating point rounding errors</span>

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">packBase60Fraction</span>(<span class="hljs-params">fraction, precision</span>) </span>{
		<span class="hljs-keyword">var</span> buffer = <span class="hljs-string">'.'</span>,
			output = <span class="hljs-string">''</span>,
			current;

		<span class="hljs-keyword">while</span> (precision &gt; <span class="hljs-number">0</span>) {
			precision  -= <span class="hljs-number">1</span>;
			fraction   *= <span class="hljs-number">60</span>;
			current     = <span class="hljs-built_in">Math</span>.floor(fraction + EPSILON);
			buffer     += BASE60[current];
			fraction   -= current;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Only add buffer to output once we have a non-zero value.
This makes '.000' output '', and '.100' output '.1'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">			<span class="hljs-keyword">if</span> (current) {
				output += buffer;
				buffer  = <span class="hljs-string">''</span>;
			}
		}

		<span class="hljs-keyword">return</span> output;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">packBase60</span>(<span class="hljs-params">number, precision</span>) </span>{
		<span class="hljs-keyword">var</span> output = <span class="hljs-string">''</span>,
			absolute = <span class="hljs-built_in">Math</span>.abs(number),
			whole = <span class="hljs-built_in">Math</span>.floor(absolute),
			fraction = packBase60Fraction(absolute - whole, <span class="hljs-built_in">Math</span>.min(~~precision, <span class="hljs-number">10</span>));

		<span class="hljs-keyword">while</span> (whole &gt; <span class="hljs-number">0</span>) {
			output = BASE60[whole % <span class="hljs-number">60</span>] + output;
			whole = <span class="hljs-built_in">Math</span>.floor(whole / <span class="hljs-number">60</span>);
		}

		<span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">0</span>) {
			output = <span class="hljs-string">'-'</span> + output;
		}

		<span class="hljs-keyword">if</span> (output &amp;&amp; fraction) {
			<span class="hljs-keyword">return</span> output + fraction;
		}

		<span class="hljs-keyword">if</span> (!fraction &amp;&amp; output === <span class="hljs-string">'-'</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-string">'0'</span>;
		}

		<span class="hljs-keyword">return</span> output || fraction || <span class="hljs-string">'0'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Pack</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">packUntils</span>(<span class="hljs-params">untils</span>) </span>{
		<span class="hljs-keyword">var</span> out = [],
			last = <span class="hljs-number">0</span>,
			i;

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; untils.length - <span class="hljs-number">1</span>; i++) {
			out[i] = packBase60(<span class="hljs-built_in">Math</span>.round((untils[i] - last) / <span class="hljs-number">1000</span>) / <span class="hljs-number">60</span>, <span class="hljs-number">1</span>);
			last = untils[i];
		}

		<span class="hljs-keyword">return</span> out.join(<span class="hljs-string">' '</span>);
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">packAbbrsAndOffsets</span>(<span class="hljs-params">source</span>) </span>{
		<span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>,
			abbrs = [],
			offsets = [],
			indices = [],
			map = {},
			i, key;

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; source.abbrs.length; i++) {
			key = source.abbrs[i] + <span class="hljs-string">'|'</span> + source.offsets[i];
			<span class="hljs-keyword">if</span> (map[key] === <span class="hljs-literal">undefined</span>) {
				map[key] = index;
				abbrs[index] = source.abbrs[i];
				offsets[index] = packBase60(<span class="hljs-built_in">Math</span>.round(source.offsets[i] * <span class="hljs-number">60</span>) / <span class="hljs-number">60</span>, <span class="hljs-number">1</span>);
				index++;
			}
			indices[i] = packBase60(map[key], <span class="hljs-number">0</span>);
		}

		<span class="hljs-keyword">return</span> abbrs.join(<span class="hljs-string">' '</span>) + <span class="hljs-string">'|'</span> + offsets.join(<span class="hljs-string">' '</span>) + <span class="hljs-string">'|'</span> + indices.join(<span class="hljs-string">''</span>);
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">packPopulation</span> (<span class="hljs-params">number</span>) </span>{
		<span class="hljs-keyword">if</span> (!number) {
			<span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
		}
		<span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">1000</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-string">'|'</span> + number;
		}
		<span class="hljs-keyword">var</span> exponent = <span class="hljs-built_in">String</span>(number | <span class="hljs-number">0</span>).length - <span class="hljs-number">2</span>;
		<span class="hljs-keyword">var</span> precision = <span class="hljs-built_in">Math</span>.round(number / <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, exponent));
		<span class="hljs-keyword">return</span> <span class="hljs-string">'|'</span> + precision + <span class="hljs-string">'e'</span> + exponent;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validatePackData</span> (<span class="hljs-params">source</span>) </span>{
		<span class="hljs-keyword">if</span> (!source.name)    { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Missing name"</span>); }
		<span class="hljs-keyword">if</span> (!source.abbrs)   { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Missing abbrs"</span>); }
		<span class="hljs-keyword">if</span> (!source.untils)  { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Missing untils"</span>); }
		<span class="hljs-keyword">if</span> (!source.offsets) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Missing offsets"</span>); }
		<span class="hljs-keyword">if</span> (
			source.offsets.length !== source.untils.length ||
			source.offsets.length !== source.abbrs.length
		) {
			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Mismatched array lengths"</span>);
		}
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pack</span> (<span class="hljs-params">source</span>) </span>{
		validatePackData(source);
		<span class="hljs-keyword">return</span> [
			source.name,
			packAbbrsAndOffsets(source),
			packUntils(source.untils) + packPopulation(source.population)
		].join(<span class="hljs-string">'|'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Create Links</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">arraysAreEqual</span>(<span class="hljs-params">a, b</span>) </span>{
		<span class="hljs-keyword">var</span> i;

		<span class="hljs-keyword">if</span> (a.length !== b.length) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; a.length; i++) {
			<span class="hljs-keyword">if</span> (a[i] !== b[i]) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">zonesAreEqual</span>(<span class="hljs-params">a, b</span>) </span>{
		<span class="hljs-keyword">return</span> arraysAreEqual(a.offsets, b.offsets) &amp;&amp; arraysAreEqual(a.abbrs, b.abbrs) &amp;&amp; arraysAreEqual(a.untils, b.untils);
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findAndCreateLinks</span> (<span class="hljs-params">input, output, links</span>) </span>{
		<span class="hljs-keyword">var</span> i, j, a, b, group, foundGroup, groups = [];

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; input.length; i++) {
			foundGroup = <span class="hljs-literal">false</span>;
			a = input[i];

			<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; groups.length; j++) {
				group = groups[j];
				b = group[<span class="hljs-number">0</span>];
				<span class="hljs-keyword">if</span> (zonesAreEqual(a, b)) {
					<span class="hljs-keyword">if</span> (a.population &gt; b.population) {
						group.unshift(a);
					} <span class="hljs-keyword">else</span> {
						group.push(a);
					}
					foundGroup = <span class="hljs-literal">true</span>;
				}
			}

			<span class="hljs-keyword">if</span> (!foundGroup) {
				groups.push([a]);
			}
		}

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; groups.length; i++) {
			group = groups[i];
			output.push(group[<span class="hljs-number">0</span>]);
			<span class="hljs-keyword">for</span> (j = <span class="hljs-number">1</span>; j &lt; group.length; j++) {
				links.push(group[<span class="hljs-number">0</span>].name + <span class="hljs-string">'|'</span> + group[j].name);
			}
		}
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createLinks</span> (<span class="hljs-params">source</span>) </span>{
		<span class="hljs-keyword">var</span> zones = [],
			links = [];

		<span class="hljs-keyword">if</span> (source.links) {
			links = source.links.slice();
		}

		findAndCreateLinks(source.zones, zones, links);

		<span class="hljs-keyword">return</span> {
			<span class="hljs-attr">version</span> : source.version,
			<span class="hljs-attr">zones</span>   : zones,
			<span class="hljs-attr">links</span>   : links.sort()
		};
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Filter Years</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findStartAndEndIndex</span> (<span class="hljs-params">untils, start, end</span>) </span>{
		<span class="hljs-keyword">var</span> startI = <span class="hljs-number">0</span>,
			endI = untils.length + <span class="hljs-number">1</span>,
			untilYear,
			i;

		<span class="hljs-keyword">if</span> (!end) {
			end = start;
		}

		<span class="hljs-keyword">if</span> (start &gt; end) {
			i = start;
			start = end;
			end = i;
		}

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; untils.length; i++) {
			<span class="hljs-keyword">if</span> (untils[i] == <span class="hljs-literal">null</span>) {
				<span class="hljs-keyword">continue</span>;
			}
			untilYear = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(untils[i]).getUTCFullYear();
			<span class="hljs-keyword">if</span> (untilYear &lt; start) {
				startI = i + <span class="hljs-number">1</span>;
			}
			<span class="hljs-keyword">if</span> (untilYear &gt; end) {
				endI = <span class="hljs-built_in">Math</span>.min(endI, i + <span class="hljs-number">1</span>);
			}
		}

		<span class="hljs-keyword">return</span> [startI, endI];
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterYears</span> (<span class="hljs-params">source, start, end</span>) </span>{
		<span class="hljs-keyword">var</span> slice     = <span class="hljs-built_in">Array</span>.prototype.slice,
			indices   = findStartAndEndIndex(source.untils, start, end),
			untils    = slice.apply(source.untils, indices);

		untils[untils.length - <span class="hljs-number">1</span>] = <span class="hljs-literal">null</span>;

		<span class="hljs-keyword">return</span> {
			<span class="hljs-attr">name</span>       : source.name,
			<span class="hljs-attr">abbrs</span>      : slice.apply(source.abbrs, indices),
			<span class="hljs-attr">untils</span>     : untils,
			<span class="hljs-attr">offsets</span>    : slice.apply(source.offsets, indices),
			<span class="hljs-attr">population</span> : source.population
		};
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Filter, Link, and Pack</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterLinkPack</span> (<span class="hljs-params">input, start, end</span>) </span>{
		<span class="hljs-keyword">var</span> i,
			inputZones = input.zones,
			outputZones = [],
			output;

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; inputZones.length; i++) {
			outputZones[i] = filterYears(inputZones[i], start, end);
		}

		output = createLinks({
			<span class="hljs-attr">zones</span> : outputZones,
			<span class="hljs-attr">links</span> : input.links.slice(),
			<span class="hljs-attr">version</span> : input.version
		});

		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; output.zones.length; i++) {
			output.zones[i] = pack(output.zones[i]);
		}

		<span class="hljs-keyword">return</span> output;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>Exports</p>
<hr>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
	moment.tz.pack           = pack;
	moment.tz.packBase60     = packBase60;
	moment.tz.createLinks    = createLinks;
	moment.tz.filterYears    = filterYears;
	moment.tz.filterLinkPack = filterLinkPack;

	<span class="hljs-keyword">return</span> moment;
}));

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
