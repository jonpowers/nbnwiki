<!DOCTYPE html>
<html>
<head>
  <title>xdg-open</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/opn/xdg-open";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#common-utility-functions-included-in-all-xdg-wrapper-scripts">Common utility functions included in all XDG wrapper scripts</a>
      </div>

      <div class="heading h1">
        <a href="#fixme-handle-vendor-dir-case">FIXME: handle vendor dir case</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>xdg-open</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-meta">#!/bin/sh
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<hr>
<p>xdg-open</p>
<p>Utility script to open a URL in the registered default application.</p>
<p>Refer to the usage() function below for usage.</p>
<p>Copyright 2009-2010, Fathi Boudra <a href="mailto:fabo@freedesktop.org.html">fabo@freedesktop.org</a>
Copyright 2009-2010, Rex Dieter <a href="mailto:rdieter@fedoraproject.org.html">rdieter@fedoraproject.org</a>
Copyright 2006, Kevin Krammer <a href="mailto:kevin.krammer@gmx.at.html">kevin.krammer@gmx.at</a>
Copyright 2006, Jeremy White <a href="mailto:jwhite@codeweavers.com.html">jwhite@codeweavers.com</a></p>
<p>LICENSE:</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the &quot;Software&quot;),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.</p>
<hr>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">manualpage</span></span>()
{
cat &lt;&lt; _MANUALPAGE
Name

   xdg-open - opens a file or URL <span class="hljs-keyword">in</span> the user<span class="hljs-string">'s preferred
   application

Synopsis

   xdg-open { file | URL }

   xdg-open { --help | --manual | --version }

Description

   xdg-open opens a file or URL in the user'</span>s preferred
   application. If a URL is provided the URL will be opened <span class="hljs-keyword">in</span> the
   user<span class="hljs-string">'s preferred web browser. If a file is provided the file
   will be opened in the preferred application for files of that
   type. xdg-open supports file, ftp, http and https URLs.

   xdg-open is for use inside a desktop session only. It is not
   recommended to use xdg-open as root.

Options

   --help
          Show command synopsis.

   --manual
          Show this manual page.

   --version
          Show the xdg-utils version information.

Exit Codes

   An exit code of 0 indicates success while a non-zero exit code
   indicates failure. The following failure codes can be returned:

   1
          Error in command line syntax.

   2
          One of the files passed on the command line did not
          exist.

   3
          A required tool could not be found.

   4
          The action failed.

Examples

xdg-open '</span>http://www.freedesktop.org/<span class="hljs-string">'

   Opens the freedesktop.org website in the user'</span>s default
   browser.

xdg-open /tmp/foobar.png

   Opens the PNG image file /tmp/foobar.png <span class="hljs-keyword">in</span> the user<span class="hljs-string">'s default
   image viewing application.
_MANUALPAGE
}

usage()
{
cat &lt;&lt; _USAGE
   xdg-open - opens a file or URL in the user'</span>s preferred
   application

Synopsis

   xdg-open { file | URL }

   xdg-open { --help | --manual | --version }

_USAGE
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>@xdg-utils-common@</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<div class="pilwrap" id="common-utility-functions-included-in-all-xdg-wrapper-scripts">
  <h2>
    <a href="#common-utility-functions-included-in-all-xdg-wrapper-scripts" name="common-utility-functions-included-in-all-xdg-wrapper-scripts" class="pilcrow"></a>
Common utility functions included in all XDG wrapper scripts
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">DEBUG</span></span>()
{
  [ -z <span class="hljs-string">"<span class="hljs-variable">${XDG_UTILS_DEBUG_LEVEL}</span>"</span> ] &amp;&amp; <span class="hljs-built_in">return</span> 0;
  [ <span class="hljs-variable">${XDG_UTILS_DEBUG_LEVEL}</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$1</span> ] &amp;&amp; <span class="hljs-built_in">return</span> 0;
  <span class="hljs-built_in">shift</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> &gt;&amp;2
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>This handles backslashes but not quote marks.</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-function"><span class="hljs-title">first_word</span></span>()
{
    <span class="hljs-built_in">read</span> first rest
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$first</span>"</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<hr>
<p>map a binary to a .desktop file</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-function"><span class="hljs-title">binary_to_desktop_file</span></span>()
{
    search=<span class="hljs-string">"<span class="hljs-variable">${XDG_DATA_HOME:-$HOME/.local/share}</span>:<span class="hljs-variable">${XDG_DATA_DIRS:-/usr/local/share:/usr/share}</span>"</span>
    binary=<span class="hljs-string">"`which "</span><span class="hljs-variable">$1</span><span class="hljs-string">"`"</span>
    binary=<span class="hljs-string">"`readlink -f "</span><span class="hljs-variable">$binary</span><span class="hljs-string">"`"</span>
    base=<span class="hljs-string">"`basename "</span><span class="hljs-variable">$binary</span><span class="hljs-string">"`"</span>
    IFS=:
    <span class="hljs-keyword">for</span> dir <span class="hljs-keyword">in</span> <span class="hljs-variable">$search</span>; <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">unset</span> IFS
        [ <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> ] || <span class="hljs-built_in">continue</span>
        [ <span class="hljs-_">-d</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>/applications"</span> ] || [ <span class="hljs-_">-d</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>/applnk"</span> ] || <span class="hljs-built_in">continue</span>
        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span>/applications/*.desktop <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span>/applications/*/*.desktop <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span>/applnk/*.desktop <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span>/applnk/*/*.desktop; <span class="hljs-keyword">do</span>
            [ -r <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ] || <span class="hljs-built_in">continue</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Check to make sure it's worth the processing.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">            grep -q <span class="hljs-string">"^Exec.*<span class="hljs-variable">$base</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> || <span class="hljs-built_in">continue</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Make sure it's a visible desktop file (e.g. not &quot;preferred-web-browser.desktop&quot;).</p>

        </td>
        <td class="code highlight">
          <pre class="sh">            grep -Eq <span class="hljs-string">"^(NoDisplay|Hidden)=true"</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> &amp;&amp; <span class="hljs-built_in">continue</span>
            <span class="hljs-built_in">command</span>=<span class="hljs-string">"`grep -E "</span>^Exec(\[[^]=]*])?=<span class="hljs-string">" "</span><span class="hljs-variable">$file</span><span class="hljs-string">" | cut -d= -f 2- | first_word`"</span>
            <span class="hljs-built_in">command</span>=<span class="hljs-string">"`which "</span><span class="hljs-variable">$command</span><span class="hljs-string">"`"</span>
            <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"`readlink -f "</span><span class="hljs-variable">$command</span><span class="hljs-string">"`"</span> = x<span class="hljs-string">"<span class="hljs-variable">$binary</span>"</span> ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Fix any double slashes that got added path composition</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> | sed <span class="hljs-_">-e</span> <span class="hljs-string">'s,//*,/,g'</span>
                <span class="hljs-built_in">return</span>
            <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">done</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <hr>
<p>map a .desktop file to a binary</p>
<div class="pilwrap" id="fixme-handle-vendor-dir-case">
  <h1>
    <a href="#fixme-handle-vendor-dir-case" name="fixme-handle-vendor-dir-case" class="pilcrow"></a>
FIXME: handle vendor dir case
  </h1>
</div>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-function"><span class="hljs-title">desktop_file_to_binary</span></span>()
{
    search=<span class="hljs-string">"<span class="hljs-variable">${XDG_DATA_HOME:-$HOME/.local/share}</span>:<span class="hljs-variable">${XDG_DATA_DIRS:-/usr/local/share:/usr/share}</span>"</span>
    desktop=<span class="hljs-string">"`basename "</span><span class="hljs-variable">$1</span><span class="hljs-string">"`"</span>
    IFS=:
    <span class="hljs-keyword">for</span> dir <span class="hljs-keyword">in</span> <span class="hljs-variable">$search</span>; <span class="hljs-keyword">do</span>
        <span class="hljs-built_in">unset</span> IFS
        [ <span class="hljs-string">"<span class="hljs-variable">$dir</span>"</span> ] &amp;&amp; [ <span class="hljs-_">-d</span> <span class="hljs-string">"<span class="hljs-variable">$dir</span>/applications"</span> ] || <span class="hljs-built_in">continue</span>
        file=<span class="hljs-string">"<span class="hljs-variable">$dir</span>/applications/<span class="hljs-variable">$desktop</span>"</span>
        [ -r <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ] || <span class="hljs-built_in">continue</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Remove any arguments (%F, %f, %U, %u, etc.).</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        <span class="hljs-built_in">command</span>=<span class="hljs-string">"`grep -E "</span>^Exec(\[[^]=]*])?=<span class="hljs-string">" "</span><span class="hljs-variable">$file</span><span class="hljs-string">" | cut -d= -f 2- | first_word`"</span>
        <span class="hljs-built_in">command</span>=<span class="hljs-string">"`which "</span><span class="hljs-variable">$command</span><span class="hljs-string">"`"</span>
        readlink <span class="hljs-_">-f</span> <span class="hljs-string">"<span class="hljs-variable">$command</span>"</span>
        <span class="hljs-built_in">return</span>
    <span class="hljs-keyword">done</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<hr>
<p>Exit script on successfully completing the desired operation</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_success</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
        <span class="hljs-built_in">echo</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 0
}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<hr>
<p>Exit script on malformed arguments, not enough arguments
or missing required option.
prints usage information</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_syntax</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Try 'xdg-open --help' for more information."</span> &gt;&amp;2
    <span class="hljs-keyword">else</span>
        usage
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Use 'man xdg-open' or 'xdg-open --manual' for additional info."</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 1
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<hr>
<p>Exit script on missing file specified on command line</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_file_missing</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 2
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<hr>
<p>Exit script on failure to locate necessary tool applications</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_operation_impossible</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 3
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<hr>
<p>Exit script on failure returned by a tool application</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_operation_failed</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 4
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<hr>
<p>Exit script on insufficient permission to read a specified file</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_file_permission_read</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 5
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<hr>
<p>Exit script on insufficient permission to write a specified file</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">exit_failure_file_permission_write</span></span>()
{
    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$@</span>"</span> &gt;&amp;2
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">exit</span> 6
}

<span class="hljs-function"><span class="hljs-title">check_input_file</span></span>()
{
    <span class="hljs-keyword">if</span> [ ! <span class="hljs-_">-e</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]; <span class="hljs-keyword">then</span>
        exit_failure_file_missing <span class="hljs-string">"file '<span class="hljs-variable">$1</span>' does not exist"</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">if</span> [ ! -r <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]; <span class="hljs-keyword">then</span>
        exit_failure_file_permission_read <span class="hljs-string">"no permission to read file '<span class="hljs-variable">$1</span>'"</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">check_vendor_prefix</span></span>()
{
    file_label=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
    [ -n <span class="hljs-string">"<span class="hljs-variable">$file_label</span>"</span> ] || file_label=<span class="hljs-string">"filename"</span>
    file=`basename <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>`
    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> <span class="hljs-keyword">in</span>
       [[:alpha:]]*-*)
         <span class="hljs-built_in">return</span>
         ;;
    <span class="hljs-keyword">esac</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open: <span class="hljs-variable">$file_label</span> '<span class="hljs-variable">$file</span>' does not have a proper vendor prefix"</span> &gt;&amp;2
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'A vendor prefix consists of alpha characters ([a-zA-Z]) and is terminated'</span> &gt;&amp;2
    <span class="hljs-built_in">echo</span> <span class="hljs-string">'with a dash ("-"). An example '</span><span class="hljs-string">"<span class="hljs-variable">$file_label</span>"</span><span class="hljs-string">' is '</span><span class="hljs-string">"'example-<span class="hljs-variable">$file</span>'"</span> &gt;&amp;2
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Use --novendor to override or 'xdg-open --manual' for additional info."</span> &gt;&amp;2
    <span class="hljs-built_in">exit</span> 1
}

<span class="hljs-function"><span class="hljs-title">check_output_file</span></span>()
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>if the file exists, check if it is writeable
if it does not exists, check if we are allowed to write on the directory</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-keyword">if</span> [ <span class="hljs-_">-e</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">if</span> [ ! -w <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]; <span class="hljs-keyword">then</span>
            exit_failure_file_permission_write <span class="hljs-string">"no permission to write to file '<span class="hljs-variable">$1</span>'"</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">else</span>
        DIR=`dirname <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>`
        <span class="hljs-keyword">if</span> [ ! -w <span class="hljs-string">"<span class="hljs-variable">$DIR</span>"</span> ] || [ ! -x <span class="hljs-string">"<span class="hljs-variable">$DIR</span>"</span> ]; <span class="hljs-keyword">then</span>
            exit_failure_file_permission_write <span class="hljs-string">"no permission to create file '<span class="hljs-variable">$1</span>'"</span>
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<hr>
<p>Checks for shared commands, e.g. --help</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">check_common_commands</span></span>()
{
    <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ] ; <span class="hljs-keyword">do</span>
        parm=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
        <span class="hljs-built_in">shift</span>

        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$parm</span>"</span> <span class="hljs-keyword">in</span>
            --help)
            usage
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"Use 'man xdg-open' or 'xdg-open --manual' for additional info."</span>
            exit_success
            ;;

            --manual)
            manualpage
            exit_success
            ;;

            --version)
            <span class="hljs-built_in">echo</span> <span class="hljs-string">"xdg-open 1.1.0 rc3"</span>
            exit_success
            ;;
        <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">done</span>
}

check_common_commands <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>

[ -z <span class="hljs-string">"<span class="hljs-variable">${XDG_UTILS_DEBUG_LEVEL}</span>"</span> ] &amp;&amp; <span class="hljs-built_in">unset</span> XDG_UTILS_DEBUG_LEVEL;
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">${XDG_UTILS_DEBUG_LEVEL-0}</span> <span class="hljs-_">-lt</span> 1 ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Be silent</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    xdg_redirect_output=<span class="hljs-string">" &gt; /dev/null 2&gt; /dev/null"</span>
<span class="hljs-keyword">else</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>All output to stderr</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    xdg_redirect_output=<span class="hljs-string">" &gt;&amp;2"</span>
<span class="hljs-keyword">fi</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<hr>
<p>Checks for known desktop environments
set variable DE to the desktop environments name, lowercase</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">detectDE</span></span>()
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>see https://bugs.freedesktop.org/show_bug.cgi?id=34164</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-built_in">unset</span> GREP_OPTIONS

    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${XDG_CURRENT_DESKTOP}</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${XDG_CURRENT_DESKTOP}</span>"</span> <span class="hljs-keyword">in</span>
         ENLIGHTENMENT)
           DE=enlightenment;
           ;;
         GNOME)
           DE=gnome;
           ;;
         KDE)
           DE=kde;
           ;;
         LXDE)
           DE=lxde;
           ;;
         MATE)
           DE=mate;
           ;;
         XFCE)
           DE=xfce
           ;;
      <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> = x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>classic fallbacks</p>

        </td>
        <td class="code highlight">
          <pre class="sh">      <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$KDE_FULL_SESSION</span>"</span> != x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span> DE=kde;
      <span class="hljs-keyword">elif</span> [ x<span class="hljs-string">"<span class="hljs-variable">$GNOME_DESKTOP_SESSION_ID</span>"</span> != x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span> DE=gnome;
      <span class="hljs-keyword">elif</span> [ x<span class="hljs-string">"<span class="hljs-variable">$MATE_DESKTOP_SESSION_ID</span>"</span> != x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span> DE=mate;
      <span class="hljs-keyword">elif</span> `dbus-send --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.GetNameOwner string:org.gnome.SessionManager &gt; /dev/null 2&gt;&amp;1` ; <span class="hljs-keyword">then</span> DE=gnome;
      <span class="hljs-keyword">elif</span> xprop -root _DT_SAVE_MODE 2&gt; /dev/null | grep <span class="hljs-string">' = \"xfce4\"$'</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span> DE=xfce;
      <span class="hljs-keyword">elif</span> xprop -root 2&gt; /dev/null | grep -i <span class="hljs-string">'^xfce_desktop_window'</span> &gt;/dev/null 2&gt;&amp;1; <span class="hljs-keyword">then</span> DE=xfce
      <span class="hljs-keyword">elif</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$DESKTOP</span> | grep -q <span class="hljs-string">'^Enlightenment'</span>; <span class="hljs-keyword">then</span> DE=enlightenment;
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> = x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>fallback to checking $DESKTOP_SESSION</p>

        </td>
        <td class="code highlight">
          <pre class="sh">      <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$DESKTOP_SESSION</span>"</span> <span class="hljs-keyword">in</span>
         gnome)
           DE=gnome;
           ;;
         LXDE|Lubuntu)
           DE=lxde; 
           ;;
         MATE)
           DE=mate;
           ;;
         xfce|xfce4|<span class="hljs-string">'Xfce Session'</span>)
           DE=xfce;
           ;;
      <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> = x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>fallback to uname output for other platforms</p>

        </td>
        <td class="code highlight">
          <pre class="sh">      <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$(uname 2&gt;/dev/null)</span>"</span> <span class="hljs-keyword">in</span> 
        Darwin)
          DE=darwin;
          ;;
      <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> = x<span class="hljs-string">"gnome"</span> ]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>gnome-default-applications-properties is only available in GNOME 2.x
but not in GNOME 3.x</p>

        </td>
        <td class="code highlight">
          <pre class="sh">      <span class="hljs-built_in">which</span> gnome-default-applications-properties &gt; /dev/null 2&gt;&amp;1  || DE=<span class="hljs-string">"gnome3"</span>
    <span class="hljs-keyword">fi</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<hr>
<p>kfmclient exec/openURL can give bogus exit value in KDE &lt;= 3.5.4
It also always returns 1 in KDE 3.4 and earlier
Simply return 0 in such case</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">kfmclient_fix_exit_code</span></span>()
{
    version=`LC_ALL=C.UTF-8 kde-config --version 2&gt;/dev/null | grep <span class="hljs-string">'^KDE'</span>`
    major=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> | sed <span class="hljs-string">'s/KDE.*: \([0-9]\).*/\1/'</span>`
    minor=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> | sed <span class="hljs-string">'s/KDE.*: [0-9]*\.\([0-9]\).*/\1/'</span>`
    release=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span> | sed <span class="hljs-string">'s/KDE.*: [0-9]*\.[0-9]*\.\([0-9]\).*/\1/'</span>`
    <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">$major</span>"</span> <span class="hljs-_">-gt</span> 3 &amp;&amp; <span class="hljs-built_in">return</span> <span class="hljs-variable">$1</span>
    <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">$minor</span>"</span> <span class="hljs-_">-gt</span> 5 &amp;&amp; <span class="hljs-built_in">return</span> <span class="hljs-variable">$1</span>
    <span class="hljs-built_in">test</span> <span class="hljs-string">"<span class="hljs-variable">$release</span>"</span> <span class="hljs-_">-gt</span> 4 &amp;&amp; <span class="hljs-built_in">return</span> <span class="hljs-variable">$1</span>
    <span class="hljs-built_in">return</span> 0
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>This handles backslashes but not quote marks.</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-function"><span class="hljs-title">last_word</span></span>()
{
    <span class="hljs-built_in">read</span> first rest
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$rest</span>"</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Get the value of a key in a desktop file's Desktop Entry group.
Example: Use get_key foo.desktop Exec
to get the values of the Exec= key for the Desktop Entry group.</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-function"><span class="hljs-title">get_key</span></span>()
{
    <span class="hljs-built_in">local</span> file=<span class="hljs-string">"<span class="hljs-variable">${1}</span>"</span>
    <span class="hljs-built_in">local</span> key=<span class="hljs-string">"<span class="hljs-variable">${2}</span>"</span>
    <span class="hljs-built_in">local</span> desktop_entry=<span class="hljs-string">""</span>

    IFS_=<span class="hljs-string">"<span class="hljs-variable">${IFS}</span>"</span>
    IFS=<span class="hljs-string">""</span>
    <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line
    <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> <span class="hljs-keyword">in</span>
            <span class="hljs-string">"[Desktop Entry]"</span>)
                desktop_entry=<span class="hljs-string">"y"</span>
            ;;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Reset match flag for other groups</p>

        </td>
        <td class="code highlight">
          <pre class="sh">            <span class="hljs-string">"["</span>*)
                desktop_entry=<span class="hljs-string">""</span>
            ;;
            <span class="hljs-string">"<span class="hljs-variable">${key}</span>="</span>*)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Only match Desktop Entry group</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${desktop_entry}</span>"</span> ]
                <span class="hljs-keyword">then</span>
                    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${line}</span>"</span> | cut <span class="hljs-_">-d</span>= <span class="hljs-_">-f</span> 2-
                <span class="hljs-keyword">fi</span>
        <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">done</span> &lt; <span class="hljs-string">"<span class="hljs-variable">${file}</span>"</span>
    IFS=<span class="hljs-string">"<span class="hljs-variable">${IFS_}</span>"</span>
}

<span class="hljs-function"><span class="hljs-title">open_darwin</span></span>()
{
    open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_kde</span></span>()
{
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${KDE_SESSION_VERSION}</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${KDE_SESSION_VERSION}</span>"</span> <span class="hljs-keyword">in</span>
        4)
          kde-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
        ;;
        5)
          kde-open<span class="hljs-variable">${KDE_SESSION_VERSION}</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
        ;;
      <span class="hljs-keyword">esac</span>
    <span class="hljs-keyword">else</span>
        kfmclient <span class="hljs-built_in">exec</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
        kfmclient_fix_exit_code $?
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_gnome</span></span>()
{
    <span class="hljs-keyword">if</span> gvfs-open --help 2&gt;/dev/null 1&gt;&amp;2; <span class="hljs-keyword">then</span>
        gvfs-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-keyword">else</span>
        gnome-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_mate</span></span>()
{
    <span class="hljs-keyword">if</span> gvfs-open --help 2&gt;/dev/null 1&gt;&amp;2; <span class="hljs-keyword">then</span>
        gvfs-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-keyword">else</span>
        mate-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_xfce</span></span>()
{
    exo-open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_enlightenment</span></span>()
{
    enlightenment_open <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<hr>
<p>Recursively search .desktop file</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-function"><span class="hljs-title">search_desktop_file</span></span>()
{
    <span class="hljs-built_in">local</span> default=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-built_in">local</span> dir=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
    <span class="hljs-built_in">local</span> target=<span class="hljs-string">"<span class="hljs-variable">$3</span>"</span>

    <span class="hljs-built_in">local</span> file=<span class="hljs-string">""</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>look for both vendor-app.desktop, vendor/app.desktop</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-keyword">if</span> [ -r <span class="hljs-string">"<span class="hljs-variable">$dir</span>/<span class="hljs-variable">$default</span>"</span> ]; <span class="hljs-keyword">then</span>
      file=<span class="hljs-string">"<span class="hljs-variable">$dir</span>/<span class="hljs-variable">$default</span>"</span>
    <span class="hljs-keyword">elif</span> [ -r <span class="hljs-string">"<span class="hljs-variable">$dir</span>/`echo <span class="hljs-variable">$default</span> | sed -e 's|-|/|'`"</span> ]; <span class="hljs-keyword">then</span>
      file=<span class="hljs-string">"<span class="hljs-variable">$dir</span>/`echo <span class="hljs-variable">$default</span> | sed -e 's|-|/|'`"</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ -r <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> ] ; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">command</span>=<span class="hljs-string">"<span class="hljs-variable">$(get_key "${file}" "Exec" | first_word)</span>"</span>
        command_exec=`<span class="hljs-built_in">which</span> <span class="hljs-variable">$command</span> 2&gt;/dev/null`
        icon=<span class="hljs-string">"<span class="hljs-variable">$(get_key "${file}" "Icon")</span>"</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>FIXME: Actually LC_MESSAGES should be used as described in
http://standards.freedesktop.org/desktop-entry-spec/latest/ar01s04.html</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        localised_name=<span class="hljs-string">"<span class="hljs-variable">$(get_key "${file}" "Name")</span>"</span>
        <span class="hljs-built_in">set</span> -- $(get_key <span class="hljs-string">"<span class="hljs-variable">${file}</span>"</span> <span class="hljs-string">"Exec"</span> | last_word)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>We need to replace any occurrence of &quot;%f&quot;, &quot;%F&quot; and
the like by the target file. We examine each
argument and append the modified argument to the
end then shift.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        <span class="hljs-built_in">local</span> args=<span class="hljs-variable">$#</span>
        <span class="hljs-built_in">local</span> replaced=0
        <span class="hljs-keyword">while</span> [ <span class="hljs-variable">$args</span> <span class="hljs-_">-gt</span> 0 ]; <span class="hljs-keyword">do</span>
            <span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
                %[c])
                    replaced=1
                    arg=<span class="hljs-string">"<span class="hljs-variable">${localised_name}</span>"</span>
                    <span class="hljs-built_in">shift</span>
                    <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span>
                    ;;
                %[fFuU])
                    replaced=1
                    arg=<span class="hljs-string">"<span class="hljs-variable">$target</span>"</span>
                    <span class="hljs-built_in">shift</span>
                    <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span>
                    ;;
                %[i])
                    replaced=1
                    <span class="hljs-built_in">shift</span>
                    <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> <span class="hljs-string">"--icon"</span> <span class="hljs-string">"<span class="hljs-variable">$icon</span>"</span>
                    ;;
                *)
                    arg=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
                    <span class="hljs-built_in">shift</span>
                    <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span>
                    ;;
            <span class="hljs-keyword">esac</span>
            args=$(( <span class="hljs-variable">$args</span> - 1 ))
        <span class="hljs-keyword">done</span>
        [ <span class="hljs-variable">$replaced</span> <span class="hljs-_">-eq</span> 1 ] || <span class="hljs-built_in">set</span> -- <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span>
        <span class="hljs-string">"<span class="hljs-variable">$command_exec</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>

        <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
            exit_success
        <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-variable">$dir</span>/*/; <span class="hljs-keyword">do</span>
        [ <span class="hljs-_">-d</span> <span class="hljs-string">"<span class="hljs-variable">$d</span>"</span> ] &amp;&amp; search_desktop_file <span class="hljs-string">"<span class="hljs-variable">$default</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$d</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$target</span>"</span>
    <span class="hljs-keyword">done</span>
}


<span class="hljs-function"><span class="hljs-title">open_generic_xdg_mime</span></span>()
{
    filetype=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>
    default=`xdg-mime query default <span class="hljs-string">"<span class="hljs-variable">$filetype</span>"</span>`
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$default</span>"</span> ] ; <span class="hljs-keyword">then</span>
        xdg_user_dir=<span class="hljs-string">"<span class="hljs-variable">$XDG_DATA_HOME</span>"</span>
        [ -n <span class="hljs-string">"<span class="hljs-variable">$xdg_user_dir</span>"</span> ] || xdg_user_dir=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.local/share"</span>

        xdg_system_dirs=<span class="hljs-string">"<span class="hljs-variable">$XDG_DATA_DIRS</span>"</span>
        [ -n <span class="hljs-string">"<span class="hljs-variable">$xdg_system_dirs</span>"</span> ] || xdg_system_dirs=/usr/<span class="hljs-built_in">local</span>/share/:/usr/share/

DEBUG 3 <span class="hljs-string">"<span class="hljs-variable">$xdg_user_dir</span>:<span class="hljs-variable">$xdg_system_dirs</span>"</span>
        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> `<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$xdg_user_dir</span>:<span class="hljs-variable">$xdg_system_dirs</span>"</span> | sed <span class="hljs-string">'s/:/ /g'</span>`; <span class="hljs-keyword">do</span>
            search_desktop_file <span class="hljs-string">"<span class="hljs-variable">$default</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$x</span>/applications/"</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
        <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_generic_xdg_file_mime</span></span>()
{
    filetype=`xdg-mime query filetype <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | sed <span class="hljs-string">"s/;.*//"</span>`
    open_generic_xdg_mime <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$filetype</span>"</span>
}

<span class="hljs-function"><span class="hljs-title">open_generic_xdg_x_scheme_handler</span></span>()
{
    scheme=<span class="hljs-string">"`echo <span class="hljs-variable">$1</span> | sed -n 's/\(^[[:alnum:]+\.-]*\):.*$/\1/p'`"</span>
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-variable">$scheme</span> ]; <span class="hljs-keyword">then</span>
        filetype=<span class="hljs-string">"x-scheme-handler/<span class="hljs-variable">$scheme</span>"</span>
        open_generic_xdg_mime <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$filetype</span>"</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-function"><span class="hljs-title">open_generic</span></span>()
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Paths or file:// URLs</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | grep -q <span class="hljs-string">'^file://'</span> ||
        ! <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | egrep -q <span class="hljs-string">'^[[:alpha:]+\.\-]+:'</span>); <span class="hljs-keyword">then</span>

        <span class="hljs-built_in">local</span> file=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Decode URLs</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        <span class="hljs-keyword">if</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> | grep -q <span class="hljs-string">'^file:///'</span>; <span class="hljs-keyword">then</span>
            file=<span class="hljs-variable">${file#file://}</span>
            file=<span class="hljs-string">"<span class="hljs-variable">$(printf "$(echo "$file" | sed -e 's@%\([a-f0-9A-F]\{2\}\)@\\x\1@g')</span>"</span>)<span class="hljs-string">"
        fi
        file_check=<span class="hljs-variable">${file%%#*}</span>
        file_check=<span class="hljs-variable">${file_check%%\?*}</span>
        check_input_file "</span><span class="hljs-variable">$file_check</span><span class="hljs-string">"

        filetype=`xdg-mime query filetype "</span><span class="hljs-variable">$file_check</span><span class="hljs-string">" | sed "</span>s/;.*//<span class="hljs-string">"`
        open_generic_xdg_mime "</span><span class="hljs-variable">$file</span><span class="hljs-string">" "</span><span class="hljs-variable">$filetype</span><span class="hljs-string">"

        if which run-mailcap 2&gt;/dev/null 1&gt;&amp;2; then
            run-mailcap --action=view "</span><span class="hljs-variable">$file</span><span class="hljs-string">"
            if [ $? -eq 0 ]; then
                exit_success
            fi
        fi

        if mimeopen -v 2&gt;/dev/null 1&gt;&amp;2; then
            mimeopen -L -n "</span><span class="hljs-variable">$file</span><span class="hljs-string">"
            if [ $? -eq 0 ]; then
                exit_success
            fi
        fi
    fi

    open_generic_xdg_x_scheme_handler "</span><span class="hljs-variable">$1</span><span class="hljs-string">"

    IFS="</span>:<span class="hljs-string">"
    for browser in <span class="hljs-variable">$BROWSER</span>; do
        if [ x"</span><span class="hljs-variable">$browser</span><span class="hljs-string">" != x"</span><span class="hljs-string">" ]; then

            browser_with_arg=`printf "</span><span class="hljs-variable">$browser</span><span class="hljs-string">" "</span><span class="hljs-variable">$1</span><span class="hljs-string">" 2&gt;/dev/null`
            if [ $? -ne 0 ]; then
                browser_with_arg=<span class="hljs-variable">$browser</span>;
            fi

            if [ x"</span><span class="hljs-variable">$browser_with_arg</span><span class="hljs-string">" = x"</span><span class="hljs-variable">$browser</span><span class="hljs-string">" ]; then
                eval '<span class="hljs-variable">$browser</span> "</span><span class="hljs-variable">$1</span><span class="hljs-string">"'<span class="hljs-variable">$xdg_redirect_output</span>;
            else eval '<span class="hljs-variable">$browser_with_arg</span>'<span class="hljs-variable">$xdg_redirect_output</span>;
            fi

            if [ $? -eq 0 ]; then
                exit_success;
            fi
        fi
    done

    exit_failure_operation_impossible "</span>no method available <span class="hljs-keyword">for</span> opening <span class="hljs-string">'$1'</span><span class="hljs-string">"
}

open_lxde()
{
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>pcmanfm only knows how to handle file:// urls and filepaths, it seems.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | grep -q <span class="hljs-string">'^file://'</span> ||
        ! <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> | egrep -q <span class="hljs-string">'^[[:alpha:]+\.\-]+:'</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">local</span> file=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>handle relative paths</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        <span class="hljs-keyword">if</span> ! <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> | egrep -q <span class="hljs-string">'^(file://)?/'</span>; <span class="hljs-keyword">then</span>
            file=<span class="hljs-string">"<span class="hljs-variable">$(pwd)</span>/<span class="hljs-variable">$file</span>"</span>
        <span class="hljs-keyword">fi</span>

        pcmanfm <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span>

    <span class="hljs-keyword">else</span>
        open_generic <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ $? <span class="hljs-_">-eq</span> 0 ]; <span class="hljs-keyword">then</span>
        exit_success
    <span class="hljs-keyword">else</span>
        exit_failure_operation_failed
    <span class="hljs-keyword">fi</span>
}

[ x<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> != x<span class="hljs-string">""</span> ] || exit_failure_syntax

url=
<span class="hljs-keyword">while</span> [ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ] ; <span class="hljs-keyword">do</span>
    parm=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    <span class="hljs-built_in">shift</span>

    <span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$parm</span>"</span> <span class="hljs-keyword">in</span>
      -*)
        exit_failure_syntax <span class="hljs-string">"unexpected option '<span class="hljs-variable">$parm</span>'"</span>
        ;;

      *)
        <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span> ] ; <span class="hljs-keyword">then</span>
            exit_failure_syntax <span class="hljs-string">"unexpected argument '<span class="hljs-variable">$parm</span>'"</span>
        <span class="hljs-keyword">fi</span>
        url=<span class="hljs-string">"<span class="hljs-variable">$parm</span>"</span>
        ;;
    <span class="hljs-keyword">esac</span>
<span class="hljs-keyword">done</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">${url}</span>"</span> ] ; <span class="hljs-keyword">then</span>
    exit_failure_syntax <span class="hljs-string">"file or URL argument missing"</span>
<span class="hljs-keyword">fi</span>

detectDE

<span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> = x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span>
    DE=generic
<span class="hljs-keyword">fi</span>

DEBUG 2 <span class="hljs-string">"Selected DE <span class="hljs-variable">$DE</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>sanitize BROWSER (avoid caling ourselves in particular)</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">${BROWSER}</span>"</span> <span class="hljs-keyword">in</span>
    *:<span class="hljs-string">"xdg-open"</span>|<span class="hljs-string">"xdg-open"</span>:*)
        BROWSER=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$BROWSER</span> | sed <span class="hljs-_">-e</span> <span class="hljs-string">'s|:xdg-open||g'</span> <span class="hljs-_">-e</span> <span class="hljs-string">'s|xdg-open:||g'</span>)
        ;;
    <span class="hljs-string">"xdg-open"</span>)
        BROWSER=
        ;;
<span class="hljs-keyword">esac</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>if BROWSER variable is not set, check some well known browsers instead</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-keyword">if</span> [ x<span class="hljs-string">"<span class="hljs-variable">$BROWSER</span>"</span> = x<span class="hljs-string">""</span> ]; <span class="hljs-keyword">then</span>
    BROWSER=links2:elinks:links:lynx:w3m
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$DISPLAY</span>"</span> ]; <span class="hljs-keyword">then</span>
        BROWSER=x-www-browser:firefox:seamonkey:mozilla:epiphany:konqueror:chromium-browser:google-chrome:<span class="hljs-variable">$BROWSER</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$DE</span>"</span> <span class="hljs-keyword">in</span>
    kde)
    open_kde <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    gnome*)
    open_gnome <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    mate)
    open_mate <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    xfce)
    open_xfce <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    lxde)
    open_lxde <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    enlightenment)
    open_enlightenment <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    generic)
    open_generic <span class="hljs-string">"<span class="hljs-variable">$url</span>"</span>
    ;;

    *)
    exit_failure_operation_impossible <span class="hljs-string">"no method available for opening '<span class="hljs-variable">$url</span>'"</span>
    ;;
<span class="hljs-keyword">esac</span>

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
