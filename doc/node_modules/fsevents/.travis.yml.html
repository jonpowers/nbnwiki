<!DOCTYPE html>
<html>
<head>
  <title>.travis.yml</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/fsevents/.travis.yml";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#commit">commit</a>
      </div>

      <div class="heading h2">
        <a href="#node">node</a>
      </div>

      <div class="heading h2">
        <a href="#publish-dependencies">publish dependencies</a>
      </div>

      <div class="heading h2">
        <a href="#package-and-publish">package &amp;amp; publish</a>
      </div>

      <div class="heading h2">
        <a href="#clean-up">clean-up</a>
      </div>

      <div class="heading h2">
        <a href="#validate">validate</a>
      </div>

      <div class="heading h2">
        <a href="#failure">failure?</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>.travis.yml</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="yaml"><span class="hljs-attr">language:</span> <span class="hljs-string">objective-c</span>

<span class="hljs-attr">env:</span>
<span class="hljs-attr">  global:</span>
<span class="hljs-attr">    - secure:</span> <span class="hljs-string">"gve1nkeKkwFEG1VAT3i+JwYyAdF0gKXwKx0uxbkBTsmm2M+0MDusohQdFLoEIkSIFktXBIDefoa7iGpLKRfG2VsZLpwJgnvnD0HqbnuR+k+W+bu7BHt4CAaR6GTllsDCjyq9zNyhUThzSnf2WNIpOEF5kHspZlbGfawURuUJH/U="</span>
<span class="hljs-attr">    - secure:</span> <span class="hljs-string">"jqVpmWxxBVXu2X8+XJMpKH0cooc2EKz9xKL2znBfYdNafJORSXcFAVbjCX5mZmVDcgIMwDtm2+gIG4P73hzJ2e3S+y2Z9ROJGyXHa3AxUTvXHQsxqzH8coHHqB8vTvfr0t2O5aKfpvpICpSea39r0hzNoMv6Ie5SwBdqj1YY9K0="</span>
<span class="hljs-attr">  matrix:</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v7"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v6"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v5"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v4"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v0.12"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="v0.10"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="iojs-v3"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="iojs-v2"</span>
<span class="hljs-bullet">    -</span> <span class="hljs-string">NODE_VERSION="iojs-v1"</span>

<span class="hljs-attr">before_install:</span>

<span class="hljs-bullet">  -</span> <span class="hljs-string">echo</span> <span class="hljs-string">$TRAVIS_OS_NAME</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="commit">
  <h2>
    <a href="#commit" name="commit" class="pilcrow"></a>
commit
  </h2>
</div>
<p>The commit message is used to determine the whether to manually
invoke a binary publish</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">COMMIT_MESSAGE=$(git</span> <span class="hljs-string">show</span> <span class="hljs-bullet">-s</span> <span class="hljs-bullet">--format=%B</span> <span class="hljs-string">$TRAVIS_COMMIT</span> <span class="hljs-string">| tr -d '\n')

</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node">
  <h2>
    <a href="#node" name="node" class="pilcrow"></a>
node
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">export</span> <span class="hljs-string">PATH=./node_modules/.bin/:$PATH</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">rm</span> <span class="hljs-bullet">-rf</span> <span class="hljs-string">~/.nvm</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-bullet">--depth</span> <span class="hljs-number">1</span> <span class="hljs-attr">https://github.com/creationix/nvm.git</span> <span class="hljs-string">~/.nvm</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">source</span> <span class="hljs-string">~/.nvm/nvm.sh</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">nvm</span> <span class="hljs-string">install</span> <span class="hljs-string">$NODE_VERSION</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">nvm</span> <span class="hljs-string">use</span> <span class="hljs-string">$NODE_VERSION</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-bullet">-g</span> <span class="hljs-string">npm@latest</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">node</span> <span class="hljs-bullet">--version</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-bullet">--version</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">nvm</span> <span class="hljs-bullet">--version</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="publish-dependencies">
  <h2>
    <a href="#publish-dependencies" name="publish-dependencies" class="pilcrow"></a>
publish dependencies
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">node-gyp</span> <span class="hljs-bullet">-g</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">aws-sdk</span>

<span class="hljs-attr">install:</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>in the first instance we build from source to create the initial binary
which can then be used to create a package</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-bullet">--build-from-source</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>

<span class="hljs-attr">before_script:</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Detemine if a publish is required.</p>
<p>a) we are building a tag
b) we put [publish binary] in the commit message</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">PUBLISH_BINARY=false</span>

<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">[[</span> <span class="hljs-string">$TRAVIS_BRANCH</span> <span class="hljs-string">==</span> <span class="hljs-string">`git</span> <span class="hljs-string">describe</span> <span class="hljs-bullet">--tags</span> <span class="hljs-bullet">--always</span> <span class="hljs-string">HEAD`</span> <span class="hljs-string">]];</span> <span class="hljs-string">then</span> <span class="hljs-string">PUBLISH_BINARY=true;</span> <span class="hljs-string">fi;</span>       <span class="hljs-comment"># a</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">test</span> <span class="hljs-string">"${COMMIT_MESSAGE#*'[publish binary]'}"</span> <span class="hljs-string">!=</span> <span class="hljs-string">"$COMMIT_MESSAGE"</span><span class="hljs-string">;</span> <span class="hljs-string">then</span> <span class="hljs-string">PUBLISH_BINARY=true;</span> <span class="hljs-string">fi;</span> <span class="hljs-comment"># b</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="package-and-publish">
  <h2>
    <a href="#package-and-publish" name="package-and-publish" class="pilcrow"></a>
package &amp; publish
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">[[</span> <span class="hljs-string">$PUBLISH_BINARY</span> <span class="hljs-string">==</span> <span class="hljs-literal">true</span> <span class="hljs-string">]];</span> <span class="hljs-string">then</span> <span class="hljs-string">node-pre-gyp</span> <span class="hljs-string">package</span> <span class="hljs-string">publish;</span> <span class="hljs-string">fi;</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="clean-up">
  <h2>
    <a href="#clean-up" name="clean-up" class="pilcrow"></a>
clean-up
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">node-pre-gyp</span> <span class="hljs-string">clean</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">node-gyp</span> <span class="hljs-string">clean</span>

<span class="hljs-attr">script:</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="validate">
  <h2>
    <a href="#validate" name="validate" class="pilcrow"></a>
validate
  </h2>
</div>
<p>Post publishing a release verify that installing will pull down latest
binary from remote host</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">INSTALL_RESULT=0</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">[[</span> <span class="hljs-string">$PUBLISH_BINARY</span> <span class="hljs-string">==</span> <span class="hljs-literal">true</span> <span class="hljs-string">]];</span> <span class="hljs-string">then</span> <span class="hljs-string">INSTALL_RESULT=$(npm</span> <span class="hljs-string">install</span> <span class="hljs-bullet">--fallback-to-build=false</span> <span class="hljs-string">&gt; /dev/null)$? || true; fi;

  - node-pre-gyp clean

</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="failure">
  <h2>
    <a href="#failure" name="failure" class="pilcrow"></a>
failure?
  </h2>
</div>
<p>if install returned non zero (errored) then we first unpublish and then
call false so travis will bail at this line.</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">[[</span> <span class="hljs-string">$INSTALL_RESULT</span> <span class="hljs-string">!=</span> <span class="hljs-number">0</span> <span class="hljs-string">]];</span> <span class="hljs-string">then</span> <span class="hljs-string">node-pre-gyp</span> <span class="hljs-string">unpublish;</span> <span class="hljs-string">fi;</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">if</span> <span class="hljs-string">[[</span> <span class="hljs-string">$INSTALL_RESULT</span> <span class="hljs-string">!=</span> <span class="hljs-number">0</span> <span class="hljs-string">]];</span> <span class="hljs-string">then</span> <span class="hljs-string">echo</span> <span class="hljs-string">"returned $INSTALL_RESULT"</span><span class="hljs-string">;false;</span> <span class="hljs-string">fi;</span>

<span class="hljs-attr">after_success:</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>display all published binaries</p>

        </td>
        <td class="code highlight">
          <pre class="yaml">
<span class="hljs-bullet"> -</span> <span class="hljs-string">node-pre-gyp</span> <span class="hljs-string">info</span>

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
