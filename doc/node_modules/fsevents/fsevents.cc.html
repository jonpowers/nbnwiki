<!DOCTYPE html>
<html>
<head>
  <title>fsevents.cc</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/fsevents/fsevents.cc";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>fsevents.cc</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<ul>
<li>Â© 2014 by Philipp Dunkel <a href="mailto:pip@pipobscure.com.html">pip@pipobscure.com</a></li>
<li>Licensed under MIT License.</li>
</ul>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="cpp">
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"nan.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"uv.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"v8.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"pthread.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CoreFoundation/CoreFoundation.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"CoreServices/CoreServices.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/storage.cc"</span></span>
<span class="hljs-keyword">namespace</span> fse {
  <span class="hljs-keyword">class</span> FSEvents : <span class="hljs-keyword">public</span> node::ObjectWrap {
  <span class="hljs-keyword">public</span>:
    FSEvents(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, Nan::Callback *handler);
    ~FSEvents();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>locking.cc</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    <span class="hljs-keyword">bool</span> lockStarted;
    <span class="hljs-keyword">pthread_mutex_t</span> lockmutex;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lockingStart</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lockingStop</span><span class="hljs-params">()</span></span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>async.cc</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    <span class="hljs-keyword">uv_async_t</span> async;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">asyncStart</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">asyncTrigger</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">asyncStop</span><span class="hljs-params">()</span></span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>thread.cc</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    <span class="hljs-keyword">pthread_t</span> thread;
    CFRunLoopRef threadloop;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">threadStart</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> *<span class="hljs-title">threadRun</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *ctx)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">threadStop</span><span class="hljs-params">()</span></span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>methods.cc - internal</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    Nan::Callback *handler;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">emitEvent</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, UInt32 flags, UInt64 id)</span></span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Common</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    CFArrayRef paths;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;fse_event*&gt; events;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span><span class="hljs-params">(v8::Handle&lt;v8::Object&gt; exports)</span></span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>methods.cc - exposed</p>

        </td>
        <td class="code highlight">
          <pre class="cpp">    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">NAN_METHOD</span><span class="hljs-params">(New)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">NAN_METHOD</span><span class="hljs-params">(Stop)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-title">NAN_METHOD</span><span class="hljs-params">(Start)</span></span>;

  };
}

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> fse;

FSEvents::FSEvents(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *path, Nan::Callback *handler): handler(handler) {
  CFStringRef dirs[] = { CFStringCreateWithCString(<span class="hljs-literal">NULL</span>, path, kCFStringEncodingUTF8) };
  paths = CFArrayCreate(<span class="hljs-literal">NULL</span>, (<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> **)&amp;dirs, <span class="hljs-number">1</span>, <span class="hljs-literal">NULL</span>);
  threadloop = <span class="hljs-literal">NULL</span>;
  lockingStart();
}
FSEvents::~FSEvents() {
  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"YIKES"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
  lockingStop();
  <span class="hljs-keyword">delete</span> handler;
  handler = <span class="hljs-literal">NULL</span>;

  CFRelease(paths);
}

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> kFSEventStreamEventFlagItemCreated</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> kFSEventStreamEventFlagItemCreated 0x00000010</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/locking.cc"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/async.cc"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/thread.cc"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/constants.cc"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"src/methods.cc"</span></span>

<span class="hljs-keyword">void</span> FSEvents::Initialize(v8::Handle&lt;v8::Object&gt; exports) {
  v8::Local&lt;v8::FunctionTemplate&gt; tpl = Nan::New&lt;v8::FunctionTemplate&gt;(FSEvents::New);
  tpl-&gt;SetClassName(Nan::New&lt;v8::String&gt;(<span class="hljs-string">"FSEvents"</span>).ToLocalChecked());
  tpl-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(<span class="hljs-number">1</span>);
  tpl-&gt;PrototypeTemplate()-&gt;Set(
           Nan::New&lt;v8::String&gt;(<span class="hljs-string">"start"</span>).ToLocalChecked(),
           Nan::New&lt;v8::FunctionTemplate&gt;(FSEvents::Start));
  tpl-&gt;PrototypeTemplate()-&gt;Set(
           Nan::New&lt;v8::String&gt;(<span class="hljs-string">"stop"</span>).ToLocalChecked(),
           Nan::New&lt;v8::FunctionTemplate&gt;(FSEvents::Stop));
  exports-&gt;Set(Nan::New&lt;v8::String&gt;(<span class="hljs-string">"Constants"</span>).ToLocalChecked(), Constants());
  exports-&gt;Set(Nan::New&lt;v8::String&gt;(<span class="hljs-string">"FSEvents"</span>).ToLocalChecked(),
               tpl-&gt;GetFunction());
}

NODE_MODULE(fse, FSEvents::Initialize)

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
