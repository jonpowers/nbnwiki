<!DOCTYPE html>
<html>
<head>
  <title>browser.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/create-ecdh/browser.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>browser.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> elliptic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'elliptic'</span>);
<span class="hljs-keyword">var</span> BN = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bn.js'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createECDH</span>(<span class="hljs-params">curve</span>) </span>{
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ECDH(curve);
};

<span class="hljs-keyword">var</span> aliases = {
	<span class="hljs-attr">secp256k1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'secp256k1'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">32</span>
	},
	<span class="hljs-attr">secp224r1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'p224'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">28</span>
	},
	<span class="hljs-attr">prime256v1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'p256'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">32</span>
	},
	<span class="hljs-attr">prime192v1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'p192'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">24</span>
	},
	<span class="hljs-attr">ed25519</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'ed25519'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">32</span>
	},
	<span class="hljs-attr">secp384r1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'p384'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">48</span>
	},
	<span class="hljs-attr">secp521r1</span>: {
		<span class="hljs-attr">name</span>: <span class="hljs-string">'p521'</span>,
		<span class="hljs-attr">byteLength</span>: <span class="hljs-number">66</span>
	}
};

aliases.p224 = aliases.secp224r1;
aliases.p256 = aliases.secp256r1 = aliases.prime256v1;
aliases.p192 = aliases.secp192r1 = aliases.prime192v1;
aliases.p384 = aliases.secp384r1;
aliases.p521 = aliases.secp521r1;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ECDH</span>(<span class="hljs-params">curve</span>) </span>{
	<span class="hljs-keyword">this</span>.curveType = aliases[curve];
	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.curveType ) {
		<span class="hljs-keyword">this</span>.curveType = {
			<span class="hljs-attr">name</span>: curve
		};
	}
	<span class="hljs-keyword">this</span>.curve = <span class="hljs-keyword">new</span> elliptic.ec(<span class="hljs-keyword">this</span>.curveType.name);
	<span class="hljs-keyword">this</span>.keys = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
}

ECDH.prototype.generateKeys = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enc, format</span>) </span>{
	<span class="hljs-keyword">this</span>.keys = <span class="hljs-keyword">this</span>.curve.genKeyPair();
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getPublicKey(enc, format);
};

ECDH.prototype.computeSecret = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">other, inenc, enc</span>) </span>{
	inenc = inenc || <span class="hljs-string">'utf8'</span>;
	<span class="hljs-keyword">if</span> (!Buffer.isBuffer(other)) {
		other = <span class="hljs-keyword">new</span> Buffer(other, inenc);
	}
	<span class="hljs-keyword">var</span> otherPub = <span class="hljs-keyword">this</span>.curve.keyFromPublic(other).getPublic();
	<span class="hljs-keyword">var</span> out = otherPub.mul(<span class="hljs-keyword">this</span>.keys.getPrivate()).getX();
	<span class="hljs-keyword">return</span> formatReturnValue(out, enc, <span class="hljs-keyword">this</span>.curveType.byteLength);
};

ECDH.prototype.getPublicKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enc, format</span>) </span>{
	<span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.keys.getPublic(format === <span class="hljs-string">'compressed'</span>, <span class="hljs-literal">true</span>);
	<span class="hljs-keyword">if</span> (format === <span class="hljs-string">'hybrid'</span>) {
		<span class="hljs-keyword">if</span> (key[key.length - <span class="hljs-number">1</span>] % <span class="hljs-number">2</span>) {
			key[<span class="hljs-number">0</span>] = <span class="hljs-number">7</span>;
		} <span class="hljs-keyword">else</span> {
			key [<span class="hljs-number">0</span>] = <span class="hljs-number">6</span>;
		}
	}
	<span class="hljs-keyword">return</span> formatReturnValue(key, enc);
};

ECDH.prototype.getPrivateKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enc</span>) </span>{
	<span class="hljs-keyword">return</span> formatReturnValue(<span class="hljs-keyword">this</span>.keys.getPrivate(), enc);
};

ECDH.prototype.setPublicKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pub, enc</span>) </span>{
	enc = enc || <span class="hljs-string">'utf8'</span>;
	<span class="hljs-keyword">if</span> (!Buffer.isBuffer(pub)) {
		pub = <span class="hljs-keyword">new</span> Buffer(pub, enc);
	}
	<span class="hljs-keyword">this</span>.keys._importPublic(pub);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

ECDH.prototype.setPrivateKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">priv, enc</span>) </span>{
	enc = enc || <span class="hljs-string">'utf8'</span>;
	<span class="hljs-keyword">if</span> (!Buffer.isBuffer(priv)) {
		priv = <span class="hljs-keyword">new</span> Buffer(priv, enc);
	}
	<span class="hljs-keyword">var</span> _priv = <span class="hljs-keyword">new</span> BN(priv);
	_priv = _priv.toString(<span class="hljs-number">16</span>);
	<span class="hljs-keyword">this</span>.keys._importPrivate(_priv);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatReturnValue</span>(<span class="hljs-params">bn, enc, len</span>) </span>{
	<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(bn)) {
		bn = bn.toArray();
	}
	<span class="hljs-keyword">var</span> buf = <span class="hljs-keyword">new</span> Buffer(bn);
	<span class="hljs-keyword">if</span> (len &amp;&amp; buf.length &lt; len) {
		<span class="hljs-keyword">var</span> zeros = <span class="hljs-keyword">new</span> Buffer(len - buf.length);
		zeros.fill(<span class="hljs-number">0</span>);
		buf = Buffer.concat([zeros, buf]);
	}
	<span class="hljs-keyword">if</span> (!enc) {
		<span class="hljs-keyword">return</span> buf;
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> buf.toString(enc);
	}
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
