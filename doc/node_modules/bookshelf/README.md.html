<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/bookshelf/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#bookshelf.js">bookshelf.js </a>
      </div>

      <div class="heading h2">
        <a href="#introduction">Introduction</a>
      </div>

      <div class="heading h2">
        <a href="#installation">Installation</a>
      </div>

      <div class="heading h2">
        <a href="#examples">Examples</a>
      </div>

      <div class="heading h2">
        <a href="#plugins">Plugins</a>
      </div>

      <div class="heading h2">
        <a href="#support">Support</a>
      </div>

      <div class="heading h2">
        <a href="#f.a.q">F.A.Q.</a>
      </div>

      <div class="heading h3">
        <a href="#can-i-use-standard-node.js-style-callbacks">Can I use standard node.js style callbacks?</a>
      </div>

      <div class="heading h3">
        <a href="#my-relations-dont-seem-to-be-loading-whats-up">My relations don&#39;t seem to be loading, what&#39;s up?</a>
      </div>

      <div class="heading h3">
        <a href="#my-process-wont-exit-after-my-script-is-finished-why">My process won&#39;t exit after my script is finished, why?</a>
      </div>

      <div class="heading h3">
        <a href="#how-do-i-debug">How do I debug?</a>
      </div>

      <div class="heading h3">
        <a href="#how-do-i-run-the-test-suite">How do I run the test suite?</a>
      </div>

      <div class="heading h3">
        <a href="#can-i-use-bookshelf-outside-of-node.js">Can I use Bookshelf outside of Node.js?</a>
      </div>

      <div class="heading h3">
        <a href="#which-open-source-projects-are-using-bookshelf">Which open-source projects are using Bookshelf?</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="bookshelf.js">
  <h1>
    <a href="#bookshelf.js" name="bookshelf.js" class="pilcrow"></a>
<a href="http://bookshelfjs.org">bookshelf.js</a> <a href="https://travis-ci.org/tgriesser/bookshelf"><img src="https://travis-ci.org/tgriesser/bookshelf.svg?branch=master" alt="Build Status"></a>
  </h1>
</div>
<p>Bookshelf is a JavaScript ORM for Node.js, built on the <a href="http://knexjs.org">Knex</a> SQL query builder. Featuring both promise based and traditional callback interfaces, providing transaction support, eager/nested-eager relation loading, polymorphic associations, and support for one-to-one, one-to-many, and many-to-many relations.</p>
<p>It is designed to work well with PostgreSQL, MySQL, and SQLite3.</p>
<p><a href="http://bookshelfjs.org">Website and documentation</a>. The project is <a href="http://github.com/tgriesser/bookshelf/">hosted on GitHub</a>, and has a comprehensive <a href="https://travis-ci.org/tgriesser/bookshelf">test suite</a>.</p>
<div class="pilwrap" id="introduction">
  <h2>
    <a href="#introduction" name="introduction" class="pilcrow"></a>
Introduction
  </h2>
</div>
<p>Bookshelf aims to provide a simple library for common tasks when querying databases in JavaScript, and forming relations between these objects, taking a lot of ideas from the the <a href="http://en.wikipedia.org/wiki/Data_mapper_pattern">Data Mapper Pattern</a>.</p>
<p>With a concise, literate codebase, Bookshelf is simple to read, understand, and extend. It doesn't force you to use any specific validation scheme, provides flexible and efficient relation/nested-relation loading, and first class transaction support.</p>
<p>It's a lean Object Relational Mapper, allowing you to drop down to the raw knex interface whenever you need a custom query that doesn't quite fit with the stock conventions.</p>
<div class="pilwrap" id="installation">
  <h2>
    <a href="#installation" name="installation" class="pilcrow"></a>
Installation
  </h2>
</div>
<p>You'll need to install a copy of <a href="http://knexjs.org/">knex.js</a>, and either mysql, pg, or sqlite3 from npm.</p>
<pre><code class="js">$ npm install knex --save
$ npm install bookshelf --save

# Then add one of the following:
$ npm install pg
$ npm install mysql
$ npm install mariasql
$ npm install sqlite3
</code></pre>
<p>The Bookshelf library is initialized by passing an initialized <a href="http://knexjs.org/">Knex</a> client instance. The <a href="http://knexjs.org/">knex documentation</a> provides a number of examples for different databases.</p>
<pre><code class="js"><span class="hljs-keyword">var</span> knex = <span class="hljs-built_in">require</span>(<span class="hljs-string">'knex'</span>)({
  <span class="hljs-attr">client</span>: <span class="hljs-string">'mysql'</span>,
  <span class="hljs-attr">connection</span>: {
    <span class="hljs-attr">host</span>     : <span class="hljs-string">'127.0.0.1'</span>,
    <span class="hljs-attr">user</span>     : <span class="hljs-string">'your_database_user'</span>,
    <span class="hljs-attr">password</span> : <span class="hljs-string">'your_database_password'</span>,
    <span class="hljs-attr">database</span> : <span class="hljs-string">'myapp_test'</span>,
    <span class="hljs-attr">charset</span>  : <span class="hljs-string">'utf8'</span>
  }
});

<span class="hljs-keyword">var</span> bookshelf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bookshelf'</span>)(knex);

<span class="hljs-keyword">var</span> User = bookshelf.Model.extend({
  <span class="hljs-attr">tableName</span>: <span class="hljs-string">'users'</span>
});
</code></pre>
<p>This initialization should likely only ever happen once in your application. As it creates a connection pool for the current database, you should use the <code>bookshelf</code> instance returned throughout your library. You'll need to store this instance created by the initialize somewhere in the application so you can reference it. A common pattern to follow is to initialize the client in a module so you can easily reference it later:</p>
<pre><code class="js"><span class="hljs-comment">// In a file named something like bookshelf.js</span>
<span class="hljs-keyword">var</span> knex = <span class="hljs-built_in">require</span>(<span class="hljs-string">'knex'</span>)(dbConfig);
<span class="hljs-built_in">module</span>.exports = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bookshelf'</span>)(knex);

<span class="hljs-comment">// elsewhere, to use the bookshelf client:</span>
<span class="hljs-keyword">var</span> bookshelf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./bookshelf'</span>);

<span class="hljs-keyword">var</span> Post = bookshelf.Model.extend({
  <span class="hljs-comment">// ...</span>
});
</code></pre>
<div class="pilwrap" id="examples">
  <h2>
    <a href="#examples" name="examples" class="pilcrow"></a>
Examples
  </h2>
</div>
<p>Here is an example to get you started:</p>
<pre><code class="js"><span class="hljs-keyword">var</span> knex = <span class="hljs-built_in">require</span>(<span class="hljs-string">'knex'</span>)({<span class="hljs-attr">client</span>: <span class="hljs-string">'mysql'</span>, <span class="hljs-attr">connection</span>: process.env.MYSQL_DATABASE_CONNECTION });
<span class="hljs-keyword">var</span> bookshelf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bookshelf'</span>)(knex);

<span class="hljs-keyword">var</span> User = bookshelf.Model.extend({
  <span class="hljs-attr">tableName</span>: <span class="hljs-string">'users'</span>,
  <span class="hljs-attr">posts</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.hasMany(Posts);
  }
});

<span class="hljs-keyword">var</span> Posts = bookshelf.Model.extend({
  <span class="hljs-attr">tableName</span>: <span class="hljs-string">'messages'</span>,
  <span class="hljs-attr">tags</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.belongsToMany(Tag);
  }
});

<span class="hljs-keyword">var</span> Tag = bookshelf.Model.extend({
  <span class="hljs-attr">tableName</span>: <span class="hljs-string">'tags'</span>
})

User.where(<span class="hljs-string">'id'</span>, <span class="hljs-number">1</span>).fetch({<span class="hljs-attr">withRelated</span>: [<span class="hljs-string">'posts.tags'</span>]}).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">user</span>) </span>{
  <span class="hljs-built_in">console</span>.log(user.related(<span class="hljs-string">'posts'</span>).toJSON());
}).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
  <span class="hljs-built_in">console</span>.error(err);
});
</code></pre>
<div class="pilwrap" id="plugins">
  <h2>
    <a href="#plugins" name="plugins" class="pilcrow"></a>
Plugins
  </h2>
</div>
<ul>
<li><a href="https://github.com/tgriesser/bookshelf/wiki/Plugin:-Model-Registry">Registry</a>: Register models in a central location so that you can refer to them using a string in relations instead of having to require it every time. Helps deal with the challenges of circular module dependencies in Node.</li>
<li><a href="https://github.com/tgriesser/bookshelf/wiki/Plugin:-Virtuals">Virtuals</a>: Define virtual properties on your model to compute new values.</li>
<li><a href="https://github.com/tgriesser/bookshelf/wiki/Plugin:-Visibility">Visibility</a>: Specify a whitelist/blacklist of model attributes when serialized toJSON.</li>
<li><a href="https://github.com/tgriesser/bookshelf/wiki/Plugin:-Pagination">Pagination</a>: Adds <code>fetchPage</code> methods to use for pagination in place of <code>fetch</code> and <code>fetchAll</code></li>
</ul>
<div class="pilwrap" id="support">
  <h2>
    <a href="#support" name="support" class="pilcrow"></a>
Support
  </h2>
</div>
<p>Have questions about the library? Come join us in the <a href="http://webchat.freenode.net/?channels=bookshelf">#bookshelf freenode IRC channel</a> for support on <a href="http://knexjs.org/">knex.js</a> and bookshelf.js, or post an issue on <a href="http://stackoverflow.com/questions/tagged/bookshelf.js">Stack Overflow</a> or in the GitHub <a href="https://github.com/tgriesser/bookshelf/issues">issue tracker</a>.</p>
<div class="pilwrap" id="f.a.q">
  <h2>
    <a href="#f.a.q" name="f.a.q" class="pilcrow"></a>
F.A.Q.
  </h2>
</div>
<div class="pilwrap" id="can-i-use-standard-node.js-style-callbacks">
  <h3>
    <a href="#can-i-use-standard-node.js-style-callbacks" name="can-i-use-standard-node.js-style-callbacks" class="pilcrow"></a>
Can I use standard node.js style callbacks?
  </h3>
</div>
<p>Yes - you can call <code>.asCallback(function(err, resp) {</code> on any &quot;sync&quot; method and use the standard <code>(err, result)</code> style callback interface if you prefer.</p>
<div class="pilwrap" id="my-relations-dont-seem-to-be-loading-whats-up">
  <h3>
    <a href="#my-relations-dont-seem-to-be-loading-whats-up" name="my-relations-dont-seem-to-be-loading-whats-up" class="pilcrow"></a>
My relations don't seem to be loading, what's up?
  </h3>
</div>
<p>Make sure you check that the type is correct for the initial parameters passed to the initial model being fetched. For example <code>new Model({id: '1'}).load([relations...])</code> will not return the same as <code>Model({id: 1}).load([relations...])</code> - notice that the id is a string in one case and a number in the other. This can be a common mistake if retrieving the id from a url parameter.</p>
<p>This is only an issue if you're eager loading data with load without first fetching the original model. <code>Model({id: '1'}).fetch({withRelated: [relations...]})</code> should work just fine.</p>
<div class="pilwrap" id="my-process-wont-exit-after-my-script-is-finished-why">
  <h3>
    <a href="#my-process-wont-exit-after-my-script-is-finished-why" name="my-process-wont-exit-after-my-script-is-finished-why" class="pilcrow"></a>
My process won't exit after my script is finished, why?
  </h3>
</div>
<p>The issue here is that Knex, the database abstraction layer used by Bookshelf, uses connection pooling and thus keeps the database connection open. If you want your process to exit after your script has finished, you will have to call <code>.destroy(cb)</code> on the <code>knex</code> property of your <code>Bookshelf</code> instance or on the <code>Knex</code> instance passed during initialization. More information about connection pooling can be found over at the <a href="http://knexjs.org/#Installation-pooling">Knex docs</a>.</p>
<div class="pilwrap" id="how-do-i-debug">
  <h3>
    <a href="#how-do-i-debug" name="how-do-i-debug" class="pilcrow"></a>
How do I debug?
  </h3>
</div>
<p>If you pass <code>{debug: true}</code> as one of the options in your initialize settings, you can see all of the query calls being made. Sometimes you need to dive a bit further into the various calls and see what all is going on behind the scenes. I'd recommend <a href="https://github.com/dannycoates/node-inspector">node-inspector</a>, which allows you to debug code with <code>debugger</code> statements like you would in the browser.</p>
<p>Bookshelf uses its own copy of the &quot;bluebird&quot; promise library, you can read up here for more on debugging these promises... but in short, adding:</p>
<pre><code>process.stderr.on('data', function(data) {
  console.log(data);
});
</code></pre>
<p>At the start of your application code will catch any errors not otherwise caught in the normal promise chain handlers, which is very helpful in debugging.</p>
<div class="pilwrap" id="how-do-i-run-the-test-suite">
  <h3>
    <a href="#how-do-i-run-the-test-suite" name="how-do-i-run-the-test-suite" class="pilcrow"></a>
How do I run the test suite?
  </h3>
</div>
<p>The test suite looks for an environment variable called <code>BOOKSHELF_TEST</code> for the path to the database configuration. If you run the following command: <code>$ export BOOKSHELF_TEST='/path/to/your/bookshelf_config.js'</code>, replacing with the path to your config file, and the config file is valid, the test suite should run with npm test.</p>
<p>Also note that you will have to create the appropriate database(s) for the test suite to run. For example, with MySQL, you'll need to run the command <code>create database bookshelf_test;</code> in addition to exporting the correct test settings prior to running the test suite.</p>
<div class="pilwrap" id="can-i-use-bookshelf-outside-of-node.js">
  <h3>
    <a href="#can-i-use-bookshelf-outside-of-node.js" name="can-i-use-bookshelf-outside-of-node.js" class="pilcrow"></a>
Can I use Bookshelf outside of Node.js?
  </h3>
</div>
<p>While it primarily targets Node.js, all dependencies are browser compatible, and it could be adapted to work with other javascript environments supporting a sqlite3 database, by providing a custom <a href="http://knexjs.org/#Adapters">Knex adapter</a>.</p>
<div class="pilwrap" id="which-open-source-projects-are-using-bookshelf">
  <h3>
    <a href="#which-open-source-projects-are-using-bookshelf" name="which-open-source-projects-are-using-bookshelf" class="pilcrow"></a>
Which open-source projects are using Bookshelf?
  </h3>
</div>
<p>We found the following projects using Bookshelf, but there can be more:</p>
<ul>
<li><a href="https://ghost.org/">Ghost</a> (A blogging platform) uses bookshelf. [<a href="https://github.com/TryGhost/Ghost/tree/master/core/server/models">Link</a>]</li>
<li><a href="http://soapee.com/">Soapee</a> (Soap Making Community and Resources) uses bookshelf. [<a href="https://github.com/nazar/soapee-api/tree/master/src/models">Link</a>]</li>
<li><a href="http://nodeza.co.za/">NodeZA</a> (Node.js social platform for developers in South Africa) uses bookshelf. [<a href="https://github.com/qawemlilo/nodeza/tree/master/models">Link</a>]</li>
<li><a href="https://github.com/sunday-cooks/sunday-cook">Sunday Cook</a> (A social cooking event platform) uses bookshelf. [<a href="https://github.com/sunday-cooks/sunday-cook/tree/master/server/bookshelf">Link</a>]</li>
<li><a href="http://www.flyptox.com/">FlyptoX</a> (Open-source Node.js cryptocurrency exchange) uses bookshelf. [<a href="https://github.com/FlipSideHR/FlyptoX/tree/master/server/models">Link</a>]</li>
<li>And of course, everything on <a href="https://www.npmjs.com/browse/depended/bookshelf">here</a> use bookshelf too.</li>
</ul>
</div>
  </div>
</body>
</html>
