<!DOCTYPE html>
<html>
<head>
  <title>CONTRIBUTING.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/bookshelf/CONTRIBUTING.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h2">
        <a href="#how-to-contribute-to-bookshelf.js">How to contribute to Bookshelf.js</a>
      </div>

      <div class="heading h3">
        <a href="#development-environment-setup">Development Environment Setup</a>
      </div>

      <div class="heading h4">
        <a href="#mysql">MySQL</a>
      </div>

      <div class="heading h4">
        <a href="#postgresql">PostgreSQL</a>
      </div>

      <div class="heading h4">
        <a href="#using-a-config-file">Using a config file</a>
      </div>

      <div class="heading h4">
        <a href="#database-creation">Database creation</a>
      </div>

      <div class="heading h3">
        <a href="#running-the-tests">Running the Tests</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="how-to-contribute-to-bookshelf.js">
  <h2>
    <a href="#how-to-contribute-to-bookshelf.js" name="how-to-contribute-to-bookshelf.js" class="pilcrow"></a>
How to contribute to Bookshelf.js
  </h2>
</div>
<ul>
<li>
<p>Before sending a pull request for a feature or bug fix, be sure to have
<a href="https://github.com/tgriesser/bookshelf/tree/master/test">tests</a>.</p>
</li>
<li>
<p>Use the same coding style as the rest of the
<a href="https://github.com/tgriesser/bookshelf/blob/master/src/bookshelf.js">codebase</a>.</p>
</li>
<li>
<p>Make changes in the /src directory, running &quot;npm run dev&quot; which will kick off
transpilation from ES6 in the background.</p>
</li>
<li>
<p>All pull requests should be made to the <code>master</code> branch.</p>
</li>
</ul>
<div class="pilwrap" id="development-environment-setup">
  <h3>
    <a href="#development-environment-setup" name="development-environment-setup" class="pilcrow"></a>
Development Environment Setup
  </h3>
</div>
<p>You'll need to have <code>git</code> installed obviously. Begin by forking the <a href="https://github.com/tgriesser/bookshelf">main
repository</a> and then getting the code from your forked copy:</p>
<pre><code class="sh">$ git <span class="hljs-built_in">clone</span> git@github.com:yourusername/bookshelf.git
</code></pre>
<p>Afterwards go to the bookshelf directory that was just created and install the dependencies:</p>
<pre><code class="sh">$ npm install
</code></pre>
<p>At this point the only thing missing are the databases that will be used for running some of the tests of the automated
test suite.</p>
<p>There are two options for setting up this part. The first one is to change some configuration options of the database
servers and the other is to use a config file in case you already have your servers configured and don't want to change
any of their config files. The first two sections below deal with the first option and then there are instructions on
how to use the other option.</p>
<div class="pilwrap" id="mysql">
  <h4>
    <a href="#mysql" name="mysql" class="pilcrow"></a>
MySQL
  </h4>
</div>
<p>You can install <a href="https://www.mysql.com/">MySQL</a> easily on most linux distros by using their package manager. With Ubuntu
this should do it:</p>
<pre><code class="sh">$ sudo apt-get install mysql-server mysql-client
</code></pre>
<p>On OSX you can download a disk image directly from the <a href="http://dev.mysql.com/downloads/mysql/">MySQL Downloads page</a>, or
use one of the popular package managers like <a href="http://brew.sh/">homebrew</a> or <a href="https://www.macports.org/">MacPorts</a>.</p>
<p>To run the test suite you will need to make sure it is possible to connect as the user <code>root</code> without the need for a
password.</p>
<p>It is strongly recommended that you use the command line <code>mysql</code> client to access your MySQL instance since there can be
problems connecting as the root user with some graphical clients like <code>phpMyAdmin</code>. To check if you can connect as root
without needing a password use the following command:</p>
<pre><code class="sh">$ mysql -u root
</code></pre>
<p>If you see an error like:</p>
<pre><code class="sh">ERROR 1045 (28000): Access denied <span class="hljs-keyword">for</span> user <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> (using password: NO)
</code></pre>
<p>that means you can't login as root without a password. If you do know the root user's password just login with the known
password like this:</p>
<pre><code class="sh">$ mysql -u root -p
</code></pre>
<p>and enter the password when asked. Then just set an empty password for root like so:</p>
<pre><code class="SQL"><span class="hljs-keyword">USE</span> mysql;
<span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">password</span> = <span class="hljs-string">""</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> = <span class="hljs-string">"root"</span>;
<span class="hljs-keyword">FLUSH</span> <span class="hljs-keyword">PRIVILEGES</span>;
QUIT;
</code></pre>
<p>Note that you'll probably need to set the password to <code>NULL</code> instead of an empty string in MySQL versions 5.5 and older.
The above example should work with versions 5.6 and newer.</p>
<p>If you have forgotten the root password you'll need to take some extra steps to reset it. Take a look at
<a href="http://stackoverflow.com/a/7825212/504930">this Stack Overflow answer</a> for further details.</p>
<div class="pilwrap" id="postgresql">
  <h4>
    <a href="#postgresql" name="postgresql" class="pilcrow"></a>
PostgreSQL
  </h4>
</div>
<p>You can install <a href="http://www.postgresql.org/">PostgreSQL</a> easily on most linux distros by using their package manager.
With Ubuntu this should do it:</p>
<pre><code class="sh">$ sudo apt-get install postgresql postgresql-client
</code></pre>
<p>On OSX the easiest way is probably by using <a href="http://postgresapp.com/">PosgresApp</a>. It should also be available to
install via <a href="http://brew.sh/">homebrew</a> or <a href="https://www.macports.org/">MacPorts</a> if you prefer.</p>
<p>In the case of PostgreSQL the requirement is to be able to connect as the <code>postgres</code> user on localhost also without the
need for a password. This can be achieved by editing or adding the following line in the <code>pg_hba.conf</code> file:</p>
<pre><code>host    all             all             127.0.0.1/32            trust
</code></pre>
<p>This file can be found in <code>/etc/postgresql/9.4/main/</code> on most linux systems. The <code>9.4</code> part could be different depending
on the version that is available in your distro. On OSX the location of this file will depend on the installation method
chosen, but for the recommended PostgresApp install it will be in <code>/Users/[yourusername]/Library/Application Support/Postgres/var-9.3/</code>. Again, the <code>var-9.3</code> part may be different depending on the version you installed.</p>
<p>The <code>trust</code> in the example above tells the locally running PostgreSQL server to ignore user passwords and always grant
access on clients connecting locally. Do not use this setting in a production environment.</p>
<p>After editing the <code>pg_hba.conf</code> file you'll need to restart the PostgreSQL server for the changes to take effect.</p>
<div class="pilwrap" id="using-a-config-file">
  <h4>
    <a href="#using-a-config-file" name="using-a-config-file" class="pilcrow"></a>
Using a config file
  </h4>
</div>
<p>If you don't want to go to the trouble of performing the changes explained in the previous two sections you can instead
use a config file that tells the test suite about your database setup.</p>
<p>The tests will look for a <code>BOOKSHELF_TEST</code> environment variable that points to a <code>config.js</code> file with the connection
details for each database server. This file must not be the same database config file you use for any other application,
otherwise you risk data loss in that application.</p>
<p>Example config file:</p>
<pre><code class="javascript"><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">mysql</span>: {
    <span class="hljs-attr">database</span>: <span class="hljs-string">'bookshelf_test'</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">'root'</span>,
    <span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf8'</span>
  },

  <span class="hljs-attr">postgres</span>: {
    <span class="hljs-attr">user</span>: <span class="hljs-string">'myusername'</span>,
    <span class="hljs-attr">database</span>: <span class="hljs-string">'bookshelf_test'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'secretpassword'</span>,
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">port</span>: <span class="hljs-number">5432</span>,
    <span class="hljs-attr">charset</span>: <span class="hljs-string">'utf8'</span>,
    <span class="hljs-attr">ssl</span>: <span class="hljs-literal">false</span>
  },

  <span class="hljs-attr">sqlite3</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">':memory:'</span>
  }
};
</code></pre>
<p>This file can be placed anywhere on your system and can have any name that you like, as long as the environment variable
is pointing correctly to it. For convenience you can put it in your home directory and add the following line to your
<code>.bashrc</code> or <code>.zshrc</code>:</p>
<pre><code>export BOOKSHELF_TEST='/home/myusername/.bookshelf_config.js'
</code></pre>
<div class="pilwrap" id="database-creation">
  <h4>
    <a href="#database-creation" name="database-creation" class="pilcrow"></a>
Database creation
  </h4>
</div>
<p>After having ensured the test suite can access both database servers just create a new database on each that will be
used exclusively by Bookshelf.js:</p>
<pre><code class="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> bookshelf_test;
</code></pre>
<div class="pilwrap" id="running-the-tests">
  <h3>
    <a href="#running-the-tests" name="running-the-tests" class="pilcrow"></a>
Running the Tests
  </h3>
</div>
<p>The test suite requires that both MySQL and PostgreSQL servers have a database named <code>bookshelf_test</code>. See the sections
above for further instructions.</p>
<p>Once you have done that, you can run the tests:</p>
<pre><code class="sh">$ npm <span class="hljs-built_in">test</span>
</code></pre>
<p>Always make sure all the tests are passing before sending a pull request.</p>
</div>
  </div>
</body>
</html>
